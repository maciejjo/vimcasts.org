
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/vimcasts.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_20 transcripts_20_en transcripts_20_en_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name"></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right search-form-wrapper">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>
            </ul>
          </section>
        </nav>

      </div>

      <nav class="compact-nav tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="right tab-bar-section">
          
            <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


          
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>

          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="identity-row">
          <div id="logo" class="logo">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          
            
          
        </div>

          

  <section class="transcript">
    <div class="title-row">
      <h2 class="title">
        Running Vim within IRB
      </h2>
      <h2 class="episode_number">
        <small>#</small>20
      </h2>
    </div>

    <div class="pubdate-row">
      <div class="transcript-context">
        This is a transcript of
        <a href="/episodes/running-vim-within-irb/">screencast&nbsp;20</a>.
      </div>
      <time class="pubdate" pubdate="pubdate" datetime="2010-05-16">
        <div class="hide-for-medium-up">May&nbsp;16, '10</div><div class="show-for-medium-up">May 16, 2010</div>
      </time>
    </div>

    <div class="summary-row">
      <div class="episode_summary enlarged">
        <p>If you work with ruby you will know that the interactive ruby shell, or &lsquo;IRB&rsquo; for short, is a useful sketchpad for coding. But the command line interface of IRB can feel quite limiting in comparison with the power of your text editor. In this episode, I&rsquo;m going to demonstrate how you can get the best of both worlds, by loading Vim from inside IRB.</p>


      </div>
    </div>

    <div class="transcript-row">
      <div class="transcript-body">
      <p>If you work with ruby, you probably know that the interactive ruby
console, or &lsquo;IRB&rsquo; for short, is a useful sketchpad for coding. But the
command line interface of IRB can feel quite limiting in comparison with
the power of your text editor. In this episode, I&rsquo;m going to demonstrate
how you can get the best of both worlds, by loading Vim from inside IRB.</p>

<ul>
<li>Limitations of IRB - multi line, history</li>
<li>Pimp irbrc</li>
<li>Demonstrate jumping into Vim, :wq to execute, vi to return</li>
<li>.vimrc helpers: syntax on</li>
<li>Deficiency: cursor position</li>
<li>.vimrc helper: restore cursor position</li>
<li>save file to file system</li>
<li>reload it from file system</li>
</ul>

<blockquote>
<p>Write a program that prints the numbers from 1 to 100. But for
multiples of three print &ldquo;Fizz&rdquo; instead of the number and for the
multiples of five print &ldquo;Buzz&rdquo;. For numbers which are multiples of
both three and five print &ldquo;FizzBuzz&rdquo;.</p>
</blockquote>

<h2>IRB limitations</h2>

<p>I&rsquo;m going to begin by demonstrating the limitations of IRB with a quick
example. Suppose I want to sketch out a loop, with an if else block
inside. I type each line, then hit enter. When I close the block, the
code is executed immediately. That instant feedback is what makes IRB
such a useful tool. But what if I wanted to change a single line in this
block? I would have to enter every line all over again. </p>
<pre class="highlight plaintext">(1..15).each do |i|
  if i%3==0
    puts "fizz"
  elsif i%5==0
    puts "buzz"
  else
    puts i
  end
end
</pre>

<h2>IRBRC</h2>

<p>Just as you can customise Vim with a dot-vimrc file, you can customize
your IRB session with a dot-irbrc file. In his Utility Belt gem, Giles
Bowkett has collected a grab-bag of tricks and techniques for IRB, the
highlight of which is the ability to interactively edit code in your
text editor. The Utility Belt gem hasn&rsquo;t been updated in a little while,
but the interactive editor has continued to evolve, thanks to [Jan
Berkel][evolution] and with help from Charles Nutter. </p>

<p>You can find instructions on how to enable the interactive editor
functionality in the show notes for this episode. </p>

<h2>Demonstrate IRB to vi</h2>

<p>Having installed the interactive editor, my IRB session is enhanced with
a <code>vi</code> method. If I launch IRB I can type <code>vi</code> followed by enter, and it
opens a new Vim session. When I save the file and exit Vim, the contents
of the buffer are evaluated in IRB. Now when I jump back into Vim, it
reopens the temporary file with the same contents as before.</p>

<p>This makes it much easier to do iterative development in IRB. If I have
several lines of code, and I want to modify just one of them, I only
need to change that one line of code, save the file, and the whole thing
will be evaluated again.</p>

<h2>Get syntax highlighting</h2>

<p>Note that the temporary file has the extension <code>.rb</code>. This means that
Vim can detect the filetype, and enable the appropriate syntax
highlighting. To benefit from this, there are a couple of things you
should include in your vimrc.</p>
<pre class="highlight plaintext">if has("autocmd")
  " Enable filetype detection
  filetype plugin indent on
endif
if &amp;t_Co &gt; 2 || has("gui_running")
  " Enable syntax highlighting
  syntax on
endif
</pre>

<p>This enables filetype detection and syntax highlighting. You might
consider the conditional blocks as optional, but they do ensure that
your vimrc remains portable, by only enabling this functionality if it
is available.</p>

<p>You may already have these enabled, so be sure to check before pasting
them into your vimrc file.</p>

<p>Having made these changes, I can now launch Vim from IRB and have my
ruby code syntax highlighted.</p>

<h2>Restore cursor position</h2>

<p>At the moment, my cursor position is reset to line 1 each time I launch
Vim. It would be nice if the cursor was restored to its last position
when I relaunched Vim. This can be achieved by adding a short snippet of
Vimscript to the vimrc file. </p>
<pre class="highlight plaintext">if has("autocmd")
  autocmd BufReadPost *
    \ if line("'\"") &gt; 1 &amp;&amp; line("'\"") &lt;= line("$") |
    \   exe "normal! g`\"" |
    \ endif
endif
</pre>

<p>Now, when I leave Vim and come back to it, the cursor is restored to its
old position.</p>

<h2>Save and reload your work</h2>

<p>If you jump in to Vim from IRB, and decide that you don&rsquo;t want to lose
your work, you can save the file to disc by passing a file name to the
<code>:w</code> command. Now if I quit Vim and exit IRB, you can see the file in my
current directory.</p>

<p>When I launch IRB again, I can pass the name of this file as an argument
to the <code>vi</code> command, and continue with my work.</p>

<p>Note that whilst Vim is open, you can open other files, but IRB will
only execute the contents of the file which was present </p>

<h2>Under the hood</h2>

<p>Here&rsquo;s a quick overview of what&rsquo;s happening under the hood:</p>
<pre class="highlight plaintext">file = File.open("mytempfile", "w")
system("vi", file.path)
eval(file.read)
</pre>

<p>Calling <code>vi</code> from IRB creates a temporary file, then launches Vim to
edit that file. When you quit Vim, ruby evalutates the contents of the
file.</p>

<p>When you call <code>vi</code> from IRB, a temporary file is created, then Vim is
launched to edit that temporary file. When you quit Vim, ruby evalutates
the contents of the file.</p>

      </div>
    </div>

  </section>

  <div class="row">
    <div class="small-12 columns">
      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>

    </div>
  </div>

  


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  

  </body>
</html>
