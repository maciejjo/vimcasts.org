<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/rrssb.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_62 transcripts_62_en transcripts_62_en_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      
        <h1><a href="/episodes/creating-mappings-that-accept-a-count/">Creating mappings that accept a count</a></h1>
        <h2>Transcript for episode #62</h2>

        <p>Lots of Vim&rsquo;s built-in Normal mode commands can be executed multiple times by prefixing them with a count. User-defined Normal mode mappings don&rsquo;t usually handle counts the way we might like them to. We&rsquo;ll explore a couple of techniques for making our custom mappings respond predictably to a count.</p>


      

      <h1>Creating mappings that accept a count</h1>

<p>Lots of Vim&rsquo;s built-in Normal mode commands can be executed multiple times by prefixing them with a count. User-defined Normal mode mappings don&rsquo;t usually handle counts the way you might like them to. We&rsquo;ll explore a couple of techniques for making your custom mappings respond predictably to a count.</p>

<p>Here&rsquo;s a task that I find myself performing often: I&rsquo;ll search for the word &lsquo;Intro&rsquo;, change it to something else, then repeat the same edit a handful of times by pressing <code>n.</code> (N-dot) again and again. That&rsquo;s two keystrokes per change. What if we could collapse that down to a single keystroke?</p>

<p>I don&rsquo;t like the built-in behaviour of the <code>Q</code> (shift-Q) command, so I like to map it to something more useful. Let&rsquo;s set up a Normal mode mapping so that pressing shift-Q executes N-dot:</p>
<pre class="highlight plaintext">nnoremap Q n.
</pre>

<p>I&rsquo;ll write that file, then source it. 
Now let&rsquo;s try out our mapping.
I&rsquo;ll search for the word &lsquo;Welcome&rsquo;, then change it back to &lsquo;Intro&rsquo;. Now each time that I press shift-Q, Vim jumps to the next match and repeats the last change.</p>

<p>I&rsquo;ll just undo each of those changes and we&rsquo;ll try something different.</p>

<p>I&rsquo;ve got search-highlighting enabled, and I can tell at a glance that I&rsquo;m going to want to repeat this change FOUR times in total. Many of Vim&rsquo;s commands can be prefixed with a count. Let&rsquo;s try using a count of FOUR with our custom mapping.</p>

<p>See what&rsquo;s happened? The <code>n</code> command has been repeated FOUR times, but the dot command was only executed one time. It would be nice if we could fix our custom mapping so that the count applied to everything, not just the very next command.</p>

<p>Here&rsquo;s one way of making this work:</p>
<pre class="highlight plaintext">nnoremap Q @='n.'&lt;CR&gt;
</pre>

<p>I&rsquo;ll write the file, then source it, now let&rsquo;s try our revised mapping. I&rsquo;ll repeat my search for &lsquo;Welcome&rsquo;, change it to &lsquo;Intro&rsquo;, then press <code>3Q</code>. Sure enough, the count has caused the change to be applied to the next 3 occurrences.</p>

<p>So how does it work? The <code>@</code> key tells Vim to execute a macro. Rather than using a named register, we use the expression register, which let&rsquo;s us specify the contents in place. The characters inside of the quotes are interpreted as keystrokes, and the carriage return enters the string into the expression register. When we execute this with a count, it applies to the entire macro, not just the very next command.</p>

<p>It&rsquo;s a pretty neat trick, but it can look a bit cryptic inside a vimrc file! Here&rsquo;s an alternative method, which I find slightly easier on the eye:</p>
<pre class="highlight plaintext">nnoremap Q :normal n.&lt;CR&gt;
</pre>

<p>This uses the <code>:normal</code> Ex command to execute n-dot. I&rsquo;ll write and source the file, and quickly demonstrate&hellip; Again, this mapping works fine with a count.</p>

<p>As an exercise, why don&rsquo;t you go through any Normal mode mappings you&rsquo;ve got in your vimrc and ask yourself: &ldquo;could this be improved by being made to accept a count?&rdquo; If the answer is yes, then I suggest that you modify the mapping to use one of these patterns.</p>

    </div>
  </div>


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>
