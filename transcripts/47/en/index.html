<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/vimcasts.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_47 transcripts_47_en transcripts_47_en_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-medium-up" data-topbar>
          <ul class="title-area">
            <li class="name"></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right search-form-wrapper">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              
<li class=""><a href="/subscribe">Subscribe</a></li>
<li class=""><a href="/categories">Browse Vimcasts</a>  
</li>
<li class=""><a href="/training">Training</a></li><li class=""><a href="/publications">Publications</a></li>
            </ul>
          </section>
        </nav>

        

      </div>

      <nav class="compact-nav tab-bar hide-for-medium-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="right tab-bar-section">
          
            <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


          
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          
<li class=""><a href="/subscribe">Subscribe</a></li>
<li class="has-dropdown"><a href="/categories">Browse Vimcasts</a>  
    <ul class="dropdown">
      <li class=""><a href="/episodes/archive">All episodes</a></li><li class=""><a href="/episodes">Latest episodes</a></li><li class=""><a href="/blog">Latest articles</a></li>
    </ul>
  
</li>
<li class=""><a href="/training">Training</a></li><li class=""><a href="/publications">Publications</a></li>

          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          

  <section class="transcript">
    <div class="title-row">
      <h2 class="title">
        Smart search with :Subvert
      </h2>
      <h2 class="episode_number">
        <small>#</small>47
      </h2>
    </div>

    <div class="pubdate-row">
      <div class="transcript-context">
        This is a transcript of
        <a href="/episodes/smart-search-with-subvert/">screencast&nbsp;47</a>.
      </div>
      <time class="pubdate" pubdate="pubdate" datetime="2013-04-12">
        <div class="hide-for-medium-up">Apr&nbsp;12, '13</div><div class="show-for-medium-up">Apr 12, 2013</div>
      </time>
    </div>

    <div class="summary-row">
      <div class="episode_summary enlarged">
        <p>The <code>:Subvert</code> command lets us create a particular style of regular expressions with ease. It&rsquo;s great for matching irregular singular and plural words in plain English and also for variable names that come in <code>snake_case</code> and <code>MixedCase</code> forms.</p>

<p><em>This is part one of a three-part series on Tim Pope&rsquo;s abolish plugin.</em></p>


      </div>
    </div>

    <div class="transcript-row">
      <div class="transcript-body">
      <h2>:Subvert - a supercharged search DSL</h2>

<p>Vim&rsquo;s search command is case-sensitive by default. I can demonstrate with this text by searching for</p>
<pre class="highlight plaintext">/pumpkin
</pre>

<p>It matches this occurrence in lowercase, but not the mixedcase occurrence here. Vim provides a few options that allow you to tune the case-sensitivity of the search command, such as <code>ignorecase</code> and <code>smartcase</code>. But I want to show you an alternative approach, as used by Tim Pope&rsquo;s abolish plugin.</p>

<p>This plugin adds a command called <code>:Subvert</code>. I&rsquo;ll call it with the text <code>pumpkin</code>:</p>
<pre class="highlight plaintext">:Subvert /pumpkin
</pre>

<p>That matches both occurrences. But watch this: if I upcase the letter &lsquo;k&rsquo;, it no longer matches. Clearly, there&rsquo;s some kind of case-sensitivity going on here. We can inspect the pattern by pasting it from the search-register:</p>
<pre class="highlight plaintext">/&lt;C-r&gt;/
\v\C%(PUMPKIN|Pumpkin|pumpkin)
</pre>

<p>The <code>\C</code> (big-C) switch enforces case-sensitivity, overriding the value of settings such as <code>ignorecase</code>. Then we get three variations of our specified text: uppercase, mixed-case, and lowercase. Nothing else will match.</p>

<p>You get the idea?</p>

<p>Now let&rsquo;s try something a bit different. The <code>:Subvert</code> command can accept a comma-seperated list of alternatives, wrapped in braces. Let&rsquo;s try searching for a few different words with a single command:</p>
<pre class="highlight plaintext">:Subvert/{pumpkin,mouse,user}
\v\C%(PUMPKIN|Pumpkin|pumpkin|MOUSE|Mouse|mouse|USER|User|user)
</pre>

<p>This time, the generated pattern includes three variations for each of the specified words. That&rsquo;s nifty!</p>

<p>Consider this: the word &lsquo;mouse&rsquo; has an irregular plural: &lsquo;mice&rsquo;. With the subvert command, we can easily generate a pattern that will match the singular and plural forms.</p>
<pre class="highlight plaintext">:S/m{ouse,ice}
</pre>

<p>The letter &rsquo;m&#39; is common to both alternatives, so I&rsquo;ve specified it outside of the comma-separated list. Admittedly, it doesn&rsquo;t save a lot of typing in this case!</p>

<h2>Variable names</h2>

<p>The subvert command is also handy if you want to find a variable name that appears in both <code>MixedCase</code> and <code>snake_case</code>. For example, in ruby, module names and class names are given in <code>MixedCase</code>, while <code>snake_case</code> is used for naming the corresponding files. </p>
<pre class="highlight plaintext">require "parslet"
require "vimprint/parser/insert_mode"
require "vimprint/parser/visual_mode"
require "vimprint/parser/cmdline_mode"
module VimPrint
  class Parser &lt; Parslet::Parser
    include InsertMode
    include VisualMode
    include CmdlineMode
  ...
  end
end
</pre>

<p>If we run the <code>:Subvert</code> command with the snake cased <code>insert_mode</code> variable, it automatically matches the mixed case version too.</p>
<pre class="highlight plaintext">:S/insert_mode
\v\C%(INSERT_MODE|insert_mode|InsertMode)
</pre>

<p>Again, we have three variations: <code>SNAKE_UPPERCASE</code>, <code>snake_case</code>, and <code>MixedCase</code>.</p>

<p>If we wanted to match these other variables, we could modify our <code>:Subvert</code> command to use a comma-separated list:</p>
<pre class="highlight plaintext">:S/{insert,visual,cmdline}_mode
</pre>

<p>Now here&rsquo;s another neat little trick: the <code>cr</code> mapping lets us quickly mutate between different styles of variable. If I press:</p>

<ul>
<li><code>crc</code>, it transforms the variable to camel case. (As a mnemonic, you can think of it as <em>coerce to camel-case</em>.) </li>
<li><code>cr-</code> uses dashes to separate the words (I&rsquo;ll undo that)</li>
<li><code>crm</code> switches to mixed case</li>
</ul>

<p>If you&rsquo;ve also installed Tim Pope&rsquo;s repeat plugin, then the dot command will work as you would expect.</p>

<ul>
<li><code>crs</code> switches back to snake case</li>
</ul>

<p>How cool is that?</p>

<h2>Using :Subvert across multiple files</h2>

<p>So far, we&rsquo;ve been using the <code>:Subvert</code> command to search inside the current buffer, but we can easily make it search across multiple files. We just have to specify the path of the directory we want to look inside:</p>
<pre class="highlight plaintext">:S /vimprint/ lib/**/*.rb
</pre>

<p>Boom!</p>
<pre class="highlight plaintext">:copen
</pre>

<p>It populates the quickfix list, just as though we&rsquo;d run the <code>:vimgrep</code> command.</p>

<p>Of course, we could achieve the same effect by pasting the pattern register into the search field of the <code>:vimgrep</code> command. We&rsquo;re working with standard Vim regexes throughout, so the patterns generated by <code>:Subvert</code> will work with any of Vim&rsquo;s pattern based commands.</p>

<h2>Outro</h2>

<p>It&rsquo;s unlikely that you would compose such a complex pattern as this by hand, but the <code>:Subvert</code> command makes it trivially easy. I like to think that it provides a domain-specific language for generating a particular style of regular expression.</p>

      </div>
    </div>

  </section>

  <div class="row">
    <div class="small-12 columns">
      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>

    </div>
  </div>

  


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  

  </body>
</html>
