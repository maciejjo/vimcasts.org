<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/vimcasts.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_56 transcripts_56_en transcripts_56_en_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name"></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right search-form-wrapper">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>
            </ul>
          </section>
        </nav>

      </div>

      <nav class="compact-nav tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="right tab-bar-section">
          
            <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


          
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>

          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Learn Essential Vim&nbsp;Skills<br/>
              <small><a href="/about/">with&nbsp;Drew Neil, author of Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          

  <section class="transcript">
    <div class="title-row">
      <h2 class="title">
        Simple calculations with Vim's expression register
      </h2>
      <h2 class="episode_number">
        <small>#</small>56
      </h2>
    </div>

    <div class="pubdate-row">
      <div class="transcript-context">
        This is a transcript of
        <a href="/episodes/simple-calculations-with-vims-expression-register/">screencast&nbsp;56</a>.
      </div>
      <time class="pubdate" pubdate="pubdate" datetime="2013-10-16">
        <div class="hide-for-medium-up">Oct&nbsp;16, '13</div><div class="show-for-medium-up">Oct 16, 2013</div>
      </time>
    </div>

    <div class="summary-row">
      <div class="episode_summary enlarged">
        <p>The <a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote=">expression register</a> lets us evaluate a snippet of Vimscript code. This is handy when you need to perform simple calculations and insert the result into the document.</p>


      </div>
    </div>

    <div class="transcript-row">
      <div class="transcript-body">
      <h2>Evaluating simple maths expressions</h2>

<p>This document contains a few simple maths problems:</p>
<pre class="highlight plaintext">21 * 2   = 
12 * 12  = 
156 / 12 = 
</pre>

<p>We&rsquo;re going to use the expression register to calculate the results and insert them into the document. I&rsquo;ll run through this three times, so don&rsquo;t worry if you don&rsquo;t catch it the first time.</p>

<p>I&rsquo;ll switch to insert mode then drop into the expression register, which moves the focus to the command line. Then I&rsquo;ll type out the expression that I want to calculate: 21 times 2, and hit enter. Boom! Vim calculates the result, and inserts it into the document.</p>

<p>I&rsquo;ll do that again, at a slower pace this time&hellip;</p>

<p>In Insert mode, watch what happens when I press &ldquo;control-R equals&rdquo;: the cursor is replaced with a double-quote symbol, which acts as a placeholder, and the focus moves to the command-line. Usually, the commandline uses a colon as the prompt, which lets us run an Ex command. But this time the prompt is an equals sign, which tells us we&rsquo;re in the expression register. I type out the sum that I want to calculate: twelve times twelve. Pressing enter tells Vim to evaluate this as a Vimscript expression, and to insert the result into the document at the cursor location, which is indicated by the double-quote placeholder.</p>

<p>Let&rsquo;s try another approach: this time I&rsquo;m going to select the text of the expression that I want to evaluate, and copy it. I&rsquo;ll switch to insert mode and dial up the expression register, which drops me into commandline mode. The &ldquo;control-R&rdquo; command works here too, so I can paste the text that I just yanked by pressing &ldquo;control-R double-quote&rdquo;. When I press enter, Vim evaluates the expression and inserts the result into the document. That&rsquo;s pretty cool!</p>

<h3>Explanation</h3>

<p>In general, we can think of Vim&rsquo;s registers as being variables that hold a string of text, but the expression register is different. This register behaves like a scratchpad, that lets us evaluate Vimscript code. If the return value is a string, or if it can be coerced to a string, then Vim will use the result just as though it had been retrieved from any other register.</p>

<h3>Mapping demo</h3>

<p>The expression register can be really useful in creating mappings. Suppose that we&rsquo;re faced with a whole page of calculations, and we have to insert the result for each one. We could speed things up by creating a mapping:</p>
<pre class="highlight plaintext">nnoremap Q 0yt=A&lt;C-r&gt;=&lt;C-r&gt;"&lt;CR&gt;&lt;Esc&gt;
</pre>

<p>Now, when I press <code>Q</code> shift-Q, Vim yanks the text from the start of the line up to (but not including) the equals sign, then pastes that text into the expression register and appends the result at the end of the line. Now we can do a unit of work with a single keystroke.</p>

<p>Here&rsquo;s one final trick. I&rsquo;ll select the range of lines that I want to change, then use the <code>:normal</code> Ex command to execute the mapping that we just created on each selected line.</p>
<pre class="highlight plaintext">:normal Q
</pre>

<p>Boom! Job done.</p>

      </div>
    </div>

  </section>

  <div class="row">
    <div class="small-12 columns">
      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>

    </div>
  </div>

  


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  

  </body>
</html>
