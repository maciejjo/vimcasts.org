<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/vimcasts.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_36 transcripts_36_en transcripts_36_en_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name"></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right search-form-wrapper">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>
            </ul>
          </section>
        </nav>

      </div>

      <nav class="compact-nav tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="right tab-bar-section">
          
            <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


          
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>

          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          

  <section class="transcript">
    <div class="title-row">
      <h2 class="title">
        VimGolf - Prime Numbers
      </h2>
      <h2 class="episode_number">
        <small>#</small>36
      </h2>
    </div>

    <div class="pubdate-row">
      <div class="transcript-context">
        This is a transcript of
        <a href="/episodes/vimgolf-prime-numbers/">screencast&nbsp;36</a>.
      </div>
      <time class="pubdate" pubdate="pubdate" datetime="2012-08-10">
        <div class="hide-for-medium-up">Aug&nbsp;10, '12</div><div class="show-for-medium-up">Aug 10, 2012</div>
      </time>
    </div>

    <div class="summary-row">
      <div class="episode_summary enlarged">
        <p>For the VimGolf challenge <a href="http://vimgolf.com/challenges/4d1c27940e3d7832db000010">&ldquo;List the first 100 prime numbers&rdquo;</a>, there&rsquo;s a solution that uses a regular expression to detect prime numbers. At 43 keystokes, it&rsquo;s not the winning solution, but I think it&rsquo;s the most interesting one. It uses a few clever Vim tricks, including macros, control-a to increment, the very magic pattern switch, and the <code>:global</code> command. There&rsquo;s a lot to learn from those 43 keystrokes, so let&rsquo;s study it!</p>


      </div>
    </div>

    <div class="transcript-row">
      <div class="transcript-body">
      <p>For the VimGolf challenge &ldquo;List the first 100 prime numbers&rdquo;, there&rsquo;s a solution that uses a regular expression to detect prime numbers. At 43 keystokes, it&rsquo;s not the winning solution, but I think it&rsquo;s the most interesting one. It uses a few clever Vim tricks, including macros, control-a to increment, the very magic pattern switch, and the <code>:global</code> command. There&rsquo;s a lot to learn from those 43 keystrokes, so let&rsquo;s study it!</p>
<pre class="highlight plaintext">C&lt;Tab&gt;1&lt;Esc&gt;
qw
&lt;C-a&gt;
&gt;&gt;
Yp
q
540@w
:g/\v^(&lt;Tab&gt;&lt;Tab&gt;+)\1+&lt;/d|%s/&lt;Tab&gt;*
ZZ
</pre>

<p>Vimcasts is supported by Xeriom networks. If you need to build a reliable, scalable network that can support your growing business needs, then get in touch with xeriom networks, and be sure to say you heard about them here.</p>

<h2>Strategy</h2>

<p>Here&rsquo;s the general strategy: we&rsquo;ll start by inserting the numbers 2, 3, 4, 5, and so on, up to 541, which is the one-hundredth prime number. Having inserted all of the numbers in this range, one per line, we&rsquo;ll then delete each line that contain a non-prime number. That should leave us with the first 100 prime numbers, and nothing else.</p>

<p>The global command will act as our sieve:</p>
<pre class="highlight plaintext">:global/{pattern}/[cmd]
</pre>

<p>This lets us execute a specified Ex command on every line of the file that matches a particular pattern. In our case, we&rsquo;ll run the <code>delete</code> Ex command, for each line that contains a non-prime number:</p>
<pre class="highlight plaintext">:global /{non-prime number}/ delete
</pre>

<p>For the golfers, note that both <code>global</code> and <code>delete</code> can be abbreviated to a single character:</p>
<pre class="highlight plaintext">:g/{non-prime number}/d
</pre>

<p>Writing a pattern that matches non-prime numbers is the clever part. And here&rsquo;s the trick: we&rsquo;ll indent each line by a number of tabs that equals the value of the number on that line. For example, the line containing the number 2 will lead with 2 tab characters. The line containing the number 3 will lead with 3 tab characters. And so on.</p>

<h2>Inserting all numbers from 2 to 541</h2>

<p>Starting with a blank document, we&rsquo;ll begin by inserting a single tab, followed by the number 1.</p>
<pre class="highlight plaintext">C&lt;Tab&gt;1&lt;Esc&gt;
</pre>

<p>Next, we&rsquo;ll start recording a macro into register <code>w</code>. The ctrl-a command increments the number on the line, then the <code>&gt;&gt;</code> &ldquo;indent&rdquo; command adds a tab at the start of the line. Finally, we&rsquo;ll duplicate the line, then stop recording the macro.</p>
<pre class="highlight plaintext">qw
&lt;C-a&gt;
&gt;&gt;
Yp
</pre>

<p>Now we can execute our macro with a count of 540, which produces all of the numbers from 2 up to 542. It&rsquo;s difficult to see what&rsquo;s happening here, so let&rsquo;s make the tab character visible:</p>
<pre class="highlight plaintext">:set list listchars=tab:▸\ ,eol:¬
</pre>

<p>And for the sake of clarity, we&rsquo;ll also set the width of a tab to a single column:</p>
<pre class="highlight plaintext">:set tabstop=1
</pre>

<p>Now you should be able to see that the line containing the number 2 leads with two tab characters, the line containing the number 3 leads with three tab characters, and so on. The general appearance resembles a staircase, which wanders constantly to the right.</p>

<h2>Deleting all non-prime numbers</h2>

<p>The next step is to delete all non-prime numbers. It can be done with this one-liner:</p>
<pre class="highlight plaintext">:g/\v^(&lt;Tab&gt;&lt;Tab&gt;+)\1+&lt;/d|%s/&lt;Tab&gt;*
</pre>

<p>Did you catch that?</p>

<p>There&rsquo;s a lot going on in that command, so let&rsquo;s undo that change and break it into chunks.</p>

<p>This regular expression does all of the hard work for us:</p>
<pre class="highlight plaintext">/\v^(   +)\1+&lt;
:set hlsearch
</pre>

<p>If we search for it, and enable the <code>hlsearch</code> option, then we&rsquo;ll see each line containing a non-prime number light up. How does that work?</p>

<p>First of all, note that the pattern begins with <code>\v</code> - the very magic switch. Here&rsquo;s the same regular expression without it:</p>
<pre class="highlight plaintext">/\v^\(   \+\)\1\+\&lt;
</pre>

<p>The very-magic switch allows us to use symbols such as parentheses, word delimiters and the plus symbol without having to escape them. That makes for a neater regular expression.</p>

<p>The less-than sign stands for the beginning of a word, or to put it another way: it stands for the end of the sequence of whitespace characters.</p>

<p>All of the magic happens in this bit in the middle. Inside the parentheses, we match two or more tab characters. These are captured in a sub-match, and we can reference this sub-match using the <code>\1</code> notation. This bit of the pattern matches one or more occurrences of the original sub-match.</p>

<p>So we have a pattern that refers to a fragment of itself. What does that mean? To understand, it helps to look at the mechanics of how a regular expression works. We&rsquo;ll run through two examples: first on a non-prime number, then on a prime number.</p>

<h3>Matching 8 tab characters</h3>

<p>The <code>+</code> operator means &ldquo;one or more&rdquo; occurrences, and it performs a greedy match. That means it matches as many characters as it can. In this case, the sub-match expands to all eight tab characters.</p>

<p>But the backreference attempts to match the same range of text again. In this case, there are no more tab characters left, so we don&rsquo;t get a match.</p>

<p>When a greedy match fails, the regular expression engine makes another attempt using a slightly less greedy match. In this case, it attempts to match 7 characters (instead of 8). That creates a submatch of 7 characters, and once again we have no match.</p>

<p>This process continues. We get no match with 6 characters, or 5. When it gets down to 4 tabs, we score a match!</p>

<p>This indicates that the number 8 is divisible by 4, so it&rsquo;s not a prime number.</p>

<h3>Attempting to match 7 tab characters</h3>

<p>Now let&rsquo;s run through the same proceedure for the number 7 - a prime.</p>

<p>Once again, the regex engine starts by doing a greedy match, which consumes all available tab characters.</p>

<p>Then the first match contracts to 6 tabs, then 5, then 4, and so on. The regex engine doesn&rsquo;t attempt anything less than two, because that was hard coded in the regular expression.</p>

<p>We can conclude that there is no way of matching 7 tab characters with this pattern. Or in other words, 7 must be a prime number.</p>

<h3>Using the prime-sieve pattern with :global</h3>

<p>This same proceedure works for every number in our document. With the search highlighting enabled, you can clearly see which numbers are non-primes. Each line that is highlighted will be deleted when we run the global command:</p>
<pre class="highlight plaintext">:g/\v^(   +)\1+&lt;/d
</pre>

<p>And that leaves us with only the prime numbers.</p>

<h3>Tidying up</h3>

<p>As a final step, we want to flatten the indentation. We can do so using this substitute command:</p>
<pre class="highlight plaintext">:%s/&lt;Tab&gt;*//
</pre>

<p>That matches every sequence of tabs, replacing each one with an empty string. The line numbers show that we have 100 lines, and we know that each one contains a prime number. So we&rsquo;re finished - we&rsquo;ve inserted the first 100 primes!</p>

<h3>Outro</h3>

<p>The regular expression </p>

<p>The information in this video is summarized in the accompanying show notes. If you have any questions, requests, or recommendations, or if you would be interested in sponsoring Vimcasts, then you can contact me at drew at vimcasts dot org. </p>

      </div>
    </div>

  </section>

  <div class="row">
    <div class="small-12 columns">
      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>

    </div>
  </div>

  


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  

  </body>
</html>
