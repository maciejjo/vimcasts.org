
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/vimcasts.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

<!--
_____________________________________________________________________
____/\\\________/\\\___/\\\\\\\\\\\___/\\\\____________/\\\\__________
____\/\\\_______\/\\\__\/////\\\///___\/\\\\\\________/\\\\\\__________
_____\//\\\______/\\\_______\/\\\______\/\\\//\\\____/\\\//\\\__________
_______\//\\\____/\\\________\/\\\______\/\\\\///\\\/\\\/_\/\\\__________
_________\//\\\__/\\\_________\/\\\______\/\\\__\///\\\/___\/\\\__________
___________\//\\\/\\\__________\/\\\______\/\\\____\///_____\/\\\__________
_____________\//\\\\\___________\/\\\______\/\\\_____________\/\\\__________
_______________\//\\\_________/\\\\\\\\\\\__\/\\\_____________\/\\\__________
_________________\///_________\///////////___\///______________\///___________
_______________________________________________________________________________


______________________________________________________________________________________________________________
___________________/\\\\\\\\\______/\\\\\\\\\_________/\\\\\\\\\\\_____/\\\\\\\\\\\\\\\______/\\\\\\\\\\\______
_________________/\\\////////_____/\\\\\\\\\\\\\_____/\\\/////////\\\__\///////\\\/////_____/\\\/////////\\\____
________________/\\\/_____________/\\\/////////\\\___\//\\\______\///_________\/\\\_________\//\\\______\///_____                                        /\\\\\\\\
________________/\\\______________\/\\\_______\/\\\____\////\\\________________\/\\\__________\////\\\____________            /\\\\\      /\\/\\\\\\\    /\\\////\\\
________________\/\\\______________\/\\\\\\\\\\\\\\\_______\////\\\_____________\/\\\_____________\////\\\_________          /\\\///\\\   \/\\\/////\\\  \//\\\\\\\\\
_________________\//\\\_____________\/\\\/////////\\\__________\////\\\__________\/\\\________________\////\\\______         /\\\  \//\\\  \/\\\   \///    \///////\\\
___________________\///\\\___________\/\\\_______\/\\\___/\\\______\//\\\_________\/\\\_________/\\\______\//\\\_____        \//\\\  /\\\   \/\\\           /\\     \\\
______________________\////\\\\\\\\\__\/\\\_______\/\\\__\///\\\\\\\\\\\/__________\/\\\________\///\\\\\\\\\\\/______  /\\\   \///\\\\\/    \/\\\          \//\\\\\\\\
__________________________\/////////___\///________\///_____\///////////____________\///___________\///////////________ \///      \/////      \///            \////////
________________________________________________________________________________________________________________________
-->

  <body class="transcripts transcripts_26 transcripts_26_en transcripts_26_en_index" data-swiftype-index='false'>

  
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2977286-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();

</script>


  

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name"></li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right search-form-wrapper">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>
            </ul>
          </section>
        </nav>

      </div>

      <nav class="compact-nav tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="right tab-bar-section">
          
            <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


          
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/episodes">Screencasts</a></li><li><a href="/blog">Articles</a></li><li><a href="/categories">Categories</a></li><li><a href="/training">Training</a></li><li><a href="/publications">Publications</a></li>
<li><a href="/subscribe">Subscribe</a></li>

          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="identity-row">
          <div id="logo" class="logo">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          
            
          
        </div>

          

  <section class="transcript">
    <div class="title-row">
      <h2 class="title">
        Bubbling text
      </h2>
      <h2 class="episode_number">
        <small>#</small>26
      </h2>
    </div>

    <div class="pubdate-row">
      <div class="transcript-context">
        This is a transcript of
        <a href="/episodes/bubbling-text/">screencast&nbsp;26</a>.
      </div>
      <time class="pubdate" pubdate="pubdate" datetime="2010-10- 5">
        <div class="hide-for-medium-up">Oct&nbsp; 5, '10</div><div class="show-for-medium-up">Oct  5, 2010</div>
      </time>
    </div>

    <div class="summary-row">
      <div class="episode_summary enlarged">
        <p>TextMate has a few built in commands for moving selected text around a document. The end end result of using these commands can be achieved by cutting and pasting, but the visual feedback they provide is quite helpful. In this episode, I will show how to replicate these commands in Vim.</p>


      </div>
    </div>

    <div class="transcript-row">
      <div class="transcript-body">
      <p>In TextMate, the commands in question can be found in the &ldquo;Text&rdquo; menu under &ldquo;Move selection&rdquo;. I find the description &ldquo;move line up&rdquo; rather bland. The motion reminds me of an air bubble moving through a glass tube of liquid, so I prefer to call this feature &ldquo;text bubbling&rdquo;. Vim doesn&rsquo;t have text bubbling built in, but we can easily replicate it by chaining together a few primitive commands. </p>

<h2>Bubbling a single line</h2>

<p>Lets start by moving the current line down a step. This can be done with the sequence of commands:</p>
<pre class="highlight plaintext">ddp
</pre>

<ul>
<li>dd - deletes the current line, and stores it in the default register</li>
<li>p  - pastes from the default register into the line below the cursor</li>
</ul>

<p>To move the current line up a step, you begin in the same fashion with &lsquo;dd&rsquo;. You might think that shift-P would place the deleted line above where it had been, but the cursor moves down to the line below where it was, and shift-P merely puts the text back where it started. So we need an extra command to move up a line before pasting the text. The full sequence of commands goes:</p>
<pre class="highlight plaintext">ddkP
"dee-dee-kay-shift-pee"
</pre>

<p>Typing a 3 or 4 letter command feels a bit arduous, so lets map these in a similar fashion to the TextMate commands. </p>

<p>[MacVim comes ready bound with mappings for the ctrl+cmd+cursor key, so rather than using the exact same key commands as TextMate, I&rsquo;m going to use control+cursor keys instead.]</p>

<p>Put the following in your .vimrc file:</p>
<pre class="highlight plaintext">" Bubble current line
nmap &lt;C-Down&gt; ddp
nmap &lt;C-Up&gt; ddkP
</pre>

<p>With these mappings in place, I can bubble the current line up and down just by holding the control key and pressing the up and down arrow keys. </p>

<h2>Bubbling multiple lines</h2>

<p>Text bubbling is most useful when used on multiple lines. To replicate this, we&rsquo;re going to have to create a similar mapping for visual mode. First, lets step through the primitive commands one by one.</p>

<p>I&rsquo;ll begin by enabling visual line mode, and selecting several lines. Then I&rsquo;m going to cut these out with the <code>x</code> key, and paste them below the cursor position with the <code>p</code> key. The text that was selected has now moved down by one line, but we&rsquo;re only halfway there. Ideally, the mapping should finish as it started: with visual mode enabled, and the same lines of text selected.</p>

<p>You may already know that you can reselect the text from the last visual selection with the command <code>gv</code>. But in this case, it doesn&rsquo;t achieve the desired result. It looks as though the selection is addressed by line numbers, and since we&rsquo;ve just cut and pasted our selection it can&rsquo;t be found at the old address.</p>

<p>Fortunately, we can select the text we want by using marks. Each time you make an edit, whether it is by typing text in insert mode or by pasting something into the document, Vim automatically marks the beginning and end of the edit. You can jump to either of these marks using the commands:</p>
<pre class="highlight plaintext">`[
"backtick-open-sqare-bracket"
</pre>

<p>to go to the beginning, or</p>
<pre class="highlight plaintext">`]
"backtick-close-sqare-bracket"
</pre>

<p>to go to the end.</p>

<p>So, to reselect the portion of text that was just pasted, I can run the commands:</p>
<pre class="highlight plaintext">`[V`]
"backtick-open-sqare-bracket, shift-V, backtick-close-sqare-bracket"
</pre>

<p>Now we have everything that we need to create a visual mode mapping for bubbling text. So I&rsquo;ll add a couple more lines to my .vimrc:</p>
<pre class="highlight plaintext">" Bubble multiple lines
vmap &lt;C-Down&gt; xp`[V`]
vmap &lt;C-Up&gt; xkP`[V`]
</pre>

<p>With these mappings in place, I can bubble a visual selection up and down just by holding the control key and pressing the up and down arrow keys. </p>

<h2>Edge Cases</h2>

<p>These mappings have a flaw which is only apparent when you use them at the boundaries of a document. For example, if I try and move the bottom line up once, instead it moves up by two lines. Remember that these mappings are blind, they just replay a series of keystrokes, without any understanding of context.</p>

<p>A better solution is available if you install Tim Pope&rsquo;s &lsquo;unimpaired&rsquo; plugin. This provides lots of useful commands, all of which are mapped to the square bracket keys in addition to one other letter. The commands that I want to focus on here are called &lsquo;exchange&rsquo;. These work just like the bubble selection commands I&rsquo;ve been talking about, except that they handle edge cases better. Instead of doing something weird, a warning message is issued, saying: &ldquo;Invalid address&rdquo;.</p>

<p>If you have the unimpaired plugin installed, then you can use the &ldquo;square bracket e&rdquo; commands to bubble text up and down. But if you are used to the TextMate key commands, you could always recreate those mappings and hook into the commands from unimpaired.</p>

<p>Whether you use the default mappings, or create your own, unimpaired brings an added bonus: bubble movement can now accept a count. So I can make a visual selection, then press <code>5 ctrl-Up</code>, and the text moves up five lines.</p>

      </div>
    </div>

  </section>

  <div class="row">
    <div class="small-12 columns">
      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/announcements">Announcements</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>

    </div>
  </div>

  


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  

  </body>
</html>
