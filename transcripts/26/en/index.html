<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="transcripts transcripts_26 transcripts_26_en transcripts_26_en_index">

  <div class="off-canvas-wrap">
    <div class="inner-wrap">
      <nav class="top-bar show-for-large-up" data-topbar>
        <ul class="title-area">
          <li class="name">
            <h1><a href="/">Vimcasts</a></h1>
          </li>
          <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
        </ul>

        <section class="top-bar-section">
          <!-- Right Nav Section -->
          <ul class="right">
            <li class="has-form">
            <div class="row collapse">
              <div class="large-8 small-9 columns">
                <input type="text" placeholder="Explore archives">
              </div>
              <div class="large-4 small-3 columns">
                <a href="#" class="alert button expand">Search</a>
              </div>
            </div>
            </li>
          </ul>

          <!-- Left Nav Section -->
          <ul class="left">
          <li><a href="/categories">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          </ul>
        </section>
      </nav>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/">Home</a></li>
          <li><a href="/episodes">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          <li>
          <form>
            <label text="search">Search: <input type="search" disabled/></label>
          </form>
          </li>
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            <h4 class="show-for-small-only text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil</small>
            </h4>
            <h4 class="show-for-medium-up text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical Vim</a></small>
            </h4>
          </div>
        </div>

        <p>In TextMate, the commands in question can be found in the "Text" menu under "Move selection". I find the description "move line up" rather bland. The motion reminds me of an air bubble moving through a glass tube of liquid, so I prefer to call this feature "text bubbling". Vim doesn't have text bubbling built in, but we can easily replicate it by chaining together a few primitive commands. </p>

<h2 id="bubbling-a-single-line">Bubbling a single line</h2>

<p>Lets start by moving the current line down a step. This can be done with the sequence of commands:</p>

<pre><code>ddp
</code></pre>

<ul>
  <li>dd - deletes the current line, and stores it in the default register</li>
  <li>p  - pastes from the default register into the line below the cursor</li>
</ul>

<p>To move the current line up a step, you begin in the same fashion with 'dd'. You might think that shift-P would place the deleted line above where it had been, but the cursor moves down to the line below where it was, and shift-P merely puts the text back where it started. So we need an extra command to move up a line before pasting the text. The full sequence of commands goes:</p>

<pre><code>ddkP
"dee-dee-kay-shift-pee"
</code></pre>

<p>Typing a 3 or 4 letter command feels a bit arduous, so lets map these in a similar fashion to the TextMate commands. </p>

<p>[MacVim comes ready bound with mappings for the ctrl+cmd+cursor key, so rather than using the exact same key commands as TextMate, I'm going to use control+cursor keys instead.]</p>

<p>Put the following in your .vimrc file:</p>

<pre><code>" Bubble current line
nmap &lt;C-Down&gt; ddp
nmap &lt;C-Up&gt; ddkP
</code></pre>

<p>With these mappings in place, I can bubble the current line up and down just by holding the control key and pressing the up and down arrow keys. </p>

<h2 id="bubbling-multiple-lines">Bubbling multiple lines</h2>

<p>Text bubbling is most useful when used on multiple lines. To replicate this, we're going to have to create a similar mapping for visual mode. First, lets step through the primitive commands one by one.</p>

<p>I'll begin by enabling visual line mode, and selecting several lines. Then I'm going to cut these out with the <code>x</code> key, and paste them below the cursor position with the <code>p</code> key. The text that was selected has now moved down by one line, but we're only halfway there. Ideally, the mapping should finish as it started: with visual mode enabled, and the same lines of text selected.</p>

<p>You may already know that you can reselect the text from the last visual selection with the command <code>gv</code>. But in this case, it doesn't achieve the desired result. It looks as though the selection is addressed by line numbers, and since we've just cut and pasted our selection it can't be found at the old address.</p>

<p>Fortunately, we can select the text we want by using marks. Each time you make an edit, whether it is by typing text in insert mode or by pasting something into the document, Vim automatically marks the beginning and end of the edit. You can jump to either of these marks using the commands:</p>

<pre><code>`[
"backtick-open-sqare-bracket"
</code></pre>

<p>to go to the beginning, or</p>

<pre><code>`]
"backtick-close-sqare-bracket"
</code></pre>

<p>to go to the end.</p>

<p>So, to reselect the portion of text that was just pasted, I can run the commands:</p>

<pre><code>`[V`]
"backtick-open-sqare-bracket, shift-V, backtick-close-sqare-bracket"
</code></pre>

<p>Now we have everything that we need to create a visual mode mapping for bubbling text. So I'll add a couple more lines to my .vimrc:</p>

<pre><code>" Bubble multiple lines
vmap &lt;C-Down&gt; xp`[V`]
vmap &lt;C-Up&gt; xkP`[V`]
</code></pre>

<p>With these mappings in place, I can bubble a visual selection up and down just by holding the control key and pressing the up and down arrow keys. </p>

<h2 id="edge-cases">Edge Cases</h2>

<p>These mappings have a flaw which is only apparent when you use them at the boundaries of a document. For example, if I try and move the bottom line up once, instead it moves up by two lines. Remember that these mappings are blind, they just replay a series of keystrokes, without any understanding of context.</p>

<p>A better solution is available if you install Tim Pope's 'unimpaired' plugin. This provides lots of useful commands, all of which are mapped to the square bracket keys in addition to one other letter. The commands that I want to focus on here are called 'exchange'. These work just like the bubble selection commands I've been talking about, except that they handle edge cases better. Instead of doing something weird, a warning message is issued, saying: "Invalid address".</p>

<p>If you have the unimpaired plugin installed, then you can use the "square bracket e" commands to bubble text up and down. But if you are used to the TextMate key commands, you could always recreate those mappings and hook into the commands from unimpaired.</p>

<p>Whether you use the default mappings, or create your own, unimpaired brings an added bonus: bubble movement can now accept a count. So I can make a visual selection, then press <code>5 ctrl-Up</code>, and the text moves up five lines.</p>

      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>


    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
