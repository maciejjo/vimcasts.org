<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Tidying whitespace</title>

    <link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>

  <body>
    <div id="logo">
      <h1>
        
          <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
        
      </h1>
    </div>
    <p>This episode demonstrates a few techniques for tidying up whitespace.  First, it looks at how to convert between tabs and spaces. Then it shows how to strip trailing whitespace, and finally, how to remove blank lines from a file.</p>

<p></p>

<h3 id="converting-between-tabs-and-spaces">Converting between tabs and spaces</h3>

<p>The command for converting between tabs and spaces is:</p>

<pre class="brush: vimscript">
:retab!
</pre>

<p>More specifically, to convert tabs to spaces, run:</p>

<pre class="brush: vimscript">
:set expandtab
:retab!
</pre>

<p>And to convert spaces to tabs, run:</p>

<pre class="brush: vimscript">
:set noexpandtab
:retab!
</pre>

<h3 id="strip-trailing-whitespace">Strip trailing whitespace</h3>

<p>Strip trailing spaces throughout an entire file by running this
substitution command:</p>

<pre class="brush: vimscript">
:%s/\s\+$//e
</pre>

<p>This has a couple of side-effects: it moves your cursor, and sets the
last item in your search history to trailing whitespace. This function
gets around these problems:</p>

<pre class="brush: vimscript">
function! &lt;SID&gt;StripTrailingWhitespaces()
    &quot; Preparation: save last search, and cursor position.
    let _s=@/
    let l = line(&quot;.&quot;)
    let c = col(&quot;.&quot;)
    &quot; Do the business:
    %s/\s\+$//e
    &quot; Clean up: restore previous search history, and cursor position
    let @/=_s
    call cursor(l, c)
endfunction
</pre>

<p>Put it in your .vimrc file.</p>

<p>If you want to map this function to a key (e.g. F5), add this:</p>

<pre class="brush: vimscript">
nnoremap &lt;silent&gt; &lt;F5&gt; :call &lt;SID&gt;StripTrailingWhitespaces()&lt;CR&gt;
</pre>

<p>If you want to run this command automatically when a file is saved,
add this:</p>

<pre class="brush: vimscript">
autocmd BufWritePre *.py,*.js :call &lt;SID&gt;StripTrailingWhitespaces()
</pre>

<p>This example runs the autocommand on python and javascript files. Use
this as a template, and add other filetypes to suit your needs.</p>

<h3 id="delete-blank-lines">Delete blank lines</h3>

<p>You can delete all blank lines by running the following command:</p>

<pre class="brush: vimscript">
:g/^$/d
</pre>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#:global"><code>:help :g[lobal]</code></a></li>
  <li><a href="http://vim.wikia.com/wiki/Remove_unwanted_spaces">Remove unwanted spaces</a> (on the Vim tips wiki)</li>
  <li><a href="http://stackoverflow.com/questions/356126/how-can-you-automatically-remove-trailing-whitespace-in-vim">Automatically remove trailing spaces</a> (on Stackoverflow.com)</li>
</ul>

<h3 id="updates">Updates</h3>

<p>In the comments, <a href="http://vimcasts.org/episodes/tidying-whitespace/?success#comment-37459247">k00pa</a> has posted a method based on
<code>StripTrailingWhitespaces()</code>, which applies Vim's autoformat command to the
entire file then restores the cursor position. <a href="http://technotales.wordpress.com/2010/03/31/preserve-a-vim-function-that-keeps-your-state/">Jonathan Palardy</a>
has recognised that <code>StripTrailingWhitespaces()</code></p>

<blockquote>
  <p>doesn’t do one thing, it does two (useful) things: saving the “state” and
executing a command to remove the trailing whitespace.</p>
</blockquote>

<p>He suggests refactoring the methods as follows:</p>

<pre class="brush: vimscript">
function! Preserve(command)
  &quot; Preparation: save last search, and cursor position.
  let _s=@/
  let l = line(&quot;.&quot;)
  let c = col(&quot;.&quot;)
  &quot; Do the business:
  execute a:command
  &quot; Clean up: restore previous search history, and cursor position
  let @/=_s
  call cursor(l, c)
endfunction 
nmap _$ :call Preserve(&quot;%s/\\s\\+$//e&quot;)&lt;CR&gt;
nmap _= :call Preserve(&quot;normal gg=G&quot;)&lt;CR&gt;
</pre>

<p>I do like his choice of key mapping as well. The underscore key is not often
used, so makes for a good alternate <code>&lt;leader&gt;</code>. The <code>$</code> key is practically
synonymous with <em>end of line</em>, so it makes for a good mnemonic.</p>

<p>Jonathan goes into a little more detail on his blog. Go read: <a href="http://technotales.wordpress.com/2010/03/31/preserve-a-vim-function-that-keeps-your-state/">Preserve: A
Vim function that keeps your state</a>.</p>


  </body>

</html>
