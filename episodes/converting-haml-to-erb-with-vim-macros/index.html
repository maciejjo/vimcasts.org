
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Converting HAML to ERB with Vim macros</title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_converting-haml-to-erb-with-vim-macros episodes_converting-haml-to-erb-with-vim-macros_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

      
    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

    </div>

    <div class="small-4 column">
      
    </div>
  </div>

</div>



      <header>
        <h2>Converting HAML to ERB with Vim macros</h2>
        <div class="episode_number">
          <small>#</small>23
        </div>
        <time pubdate="pubdate" datetime="2010-07- 8">
          Jul  8, 2010
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P7M,36S">
            7:36
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/macros">macros</a>, <a href="/categories/showcase">showcase</a>
          </div>
        
      </header>

      <div data-swiftype-index="true">
        <p>HAML and ERB are two commonly used ruby templating languages. You may have a strong preference for one or the other, but it&rsquo;s not always up to you which one you use. I was recently asked to convert several HAML files to ERB format. In this episode, I will demonstrate a couple of Vim macros that helped make short work of the task. </p>


      </div>

      <video poster="http://vimcasts.org/images/posters/haml_to_erb.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_23_placeholder">
        <source src="http://media.vimcasts.org/videos/23/haml_to_erb.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/23/haml_to_erb.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          <a href="http://media.vimcasts.org/videos/23/haml_to_erb.ogv">OGG</a>
          <span class="stats">11.1 MB</span>
          </li>

          <li class="quicktime">
          <a href="http://media.vimcasts.org/videos/23/haml_to_erb.m4v">Quicktime</a>
          <span class="stats">15.9 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/23/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content" data-swiftype-index="true">
          

<p>This is not intended to be a complete solution for converting haml files to erb. Indeed, there may be better ways to approach this problem (and if you know of any, I&rsquo;d be glad to hear about them in the comments below). The point of this demonstration is to showcase some of the things that you can acheive using Vim&rsquo;s macros. You may encounter other scenarios where these techniques come in useful.</p>

<h3>Single line conversion</h3>

<p>For a haml one-liner the conversion to ERB is straightforward. The following steps were taken:</p>

<ul>
<li><code>qp</code> to record keystrokes into the <strong>p</strong> register</li>
<li><code>I</code> to insert &ldquo;&lt;%&rdquo; at the beginning of the line</li>
<li><code>A</code> to append &ldquo; %&gt;&rdquo; at the end of the line</li>
<li><code>q</code> to finish recording the macro</li>
</ul>

<p>I then searched for the pattern <code>^\s*=</code> to jump to the next one-liner. The macro can be replayed by pressing <code>@p</code>. Subsequent one-liners can be converted by running <code>n@@</code> - <code>n</code> jumps to the next match, and <code>@@</code> replays the macro that was most recently played.</p>

<h3>Multi-line conversion</h3>

<p>Whereas haml uses significant whitespace to delimit blocks (in a similar fashion to <a href="http://www.python.org/">Python</a>), erb uses the <code>end</code> keyword (like tradtional <a href="http://ruby-lang.org/">Ruby</a>). I created a macro that allows me to visually select a region that needs to be terminated with an <code>end</code> keyword. Playing the macro converts the first line to erb by wrapping it in <code>&lt;%- %&gt;</code> delimitters, then appends the <code>&lt;% end %&gt;</code> keyword after the block.</p>

<p>The macro works by setting marks at the top and bottom of the visual selection. This allows me to jump between the two regions that need to be edited. You can set a mark by pressing <code>m</code> followed by a letter. I chose to use the letter &rsquo;t&#39; for the top mark, and &lsquo;b&rsquo; for the bottom mark because I find these easy to remember. You can use whatever mnemonic suits you. Having set the marks, you can then jump to them by typing <code>&#39;t</code>. That is, single-quote followed by the letter of the mark you want to jump to.</p>

<h3>Auto-indentation</h3>

<p>When I open an ERB file, Vim detects the filetype from the file extension and sets the auto indentation accordingly. In this case, I have a HAML file with the ERB extension. This is going to confuse Vim&rsquo;s automatic indentation, so I switched it off by running:</p>
<pre class="highlight plaintext">:set indentexpr=
</pre>

<h3>Further reading</h3>

<ul>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#q"><code>:h q</code> - macros</a></li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#m"><code>:h m</code> - marks</a></li>
</ul>

        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>


      <div>
  <hr/>
  <h3>Related content</h3>
  <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">

    
    

    
      <li>
        <h4><a href="/publications">Publications</a></h4>
        <p>Make yourself a faster and more efficient developer with the help of <a href='/publications'>these publications</a>.</p>
      </li>
    
      <li>
        <h4><a href="/training">Vim Training</a></h4>
        <p>Boost your productivity with a <a href='/training'>Vim training class</a>. Join a public class, or <a href='/training/private'>book a private session</a> for your team.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/vimgolf-prime-numbers/">VimGolf - Prime Numbers</a></h4>
        <p>For the VimGolf challenge <a href="http://vimgolf.com/challenges/4d1c27940e3d7832db000010">&ldquo;List the first 100 prime numbers&rdquo;</a>, there&rsquo;s a solution that uses a regular expression to detect prime numbers. At 43 keystokes, it&rsquo;s not the winning solution, but I think it&rsquo;s the most interesting one. It uses a few clever Vim tricks, including macros, control-a to increment, the very magic pattern switch, and the <code>:global</code> command. There&rsquo;s a lot to learn from those 43 keystrokes, so let&rsquo;s study it!</p>


      </li>
    
      <li>
        <h4><a href="/categories">Find by category</a></h4>
        <p>Vimcasts contains 65 free screencasts and 45 articles. <a href='/categories'>Browse all content by category</a>.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/converting-markdown-to-structured-html-with-a-macro/">Converting markdown to structured HTML with a macro</a></h4>
        <p>Recording your keystrokes as a macro can be a great timesaver, but you have to be careful that you use commands in such a way that they can be reused. In this episode, I construct a fairly complex macro to build a structural HTML document from markdown.</p>


      </li>
    
      <li>
        <h4><a href="/episodes/creating-the-vimcasts-logo-as-ascii-art/">Creating the Vimcasts logo as ASCII art</a></h4>
        <p>Demonstrating miscellaneous tips and tricks gleaned whilst making an ASCII art version of the VimCasts.org logo. Learn how to duplicate lines, copy and paste with visual block mode, search and replace within a visual selection, and how to use macros.</p>


      </li>
    

  </ul>
</div>


      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>

