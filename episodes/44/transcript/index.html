<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg.rss" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime.rss" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_44 episodes_44_transcript episodes_44_transcript_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

        <h2>Using vimgrep on the current file</h2>

<p>Here&rsquo;s a common search use-case in Vim. We start by searching for a pattern: here I&rsquo;m using a regular expression that matches text wrapped in backticks. Then we can use the <code>n</code> command to jump through the matches.</p>
<pre class="highlight plaintext">/\v`[^`]*`
nnn
</pre>

<p>When we get to the bottom of the file, Vim cycles round to the top, and keeps going. If you watch closely, you&rsquo;ll see a message that says:</p>
<pre class="highlight plaintext">Search hit bottom, continuing at top
</pre>

<p>but it&rsquo;s easy to miss that message. For that reason, I occasionally become disoriented, and don&rsquo;t realize that I&rsquo;m revisiting matches that I&rsquo;ve already looked at. Have you ever wished that Vim would report your position, by saying, for example: &lsquo;this is match 2 out of 5&rsquo;?</p>

<p>That&rsquo;s not a feature provided by Vim&rsquo;s search command, but it is a feature supplied by the quickfix list. We can use the <code>:vimgrep</code> command to populate the quickfix list with search results from the current file.</p>
<pre class="highlight plaintext">:vimgrep /pattern/g %
</pre>

<p>Let&rsquo;s use <code>vimgrep</code> to search for the same pattern as before.</p>

<p>We&rsquo;ll break down how this command works in just a minute, but first lets look at the result. The cursor has jumped to the first match in the file, and there&rsquo;s a message at the bottom of the screen saying <code>(1 of 9)</code>. We can advance through the records in the quickfix list using the <code>:cnext</code> command. Note that the quickfix status message updates each time (1 of 9, 2 of 9, and so on). We can reverse through the matches with the <code>:cprev</code> command.</p>

<p>I prefer to use the quickfix mappings provided by Tim Pope&rsquo;s unimpaired plugin.</p>
<pre class="highlight plaintext">[q - :cprev
]q - :cnext
[Q - :cfirst
]Q - :clast
</pre>

<p>Using these, I can quickly navigate the matches in this file.  Note that when I reach the end of the list, it doesn&rsquo;t cycle round to the beginning when I try to advance.</p>

<h2>Mechanics of the :vimgrep command</h2>

<p>Let&rsquo;s have a closer look at the <code>:vimgrep</code> command.</p>
<pre class="highlight plaintext">:help vimgrep
:vim[grep] /pattern/ {file} ...
</pre>

<p>This command takes two arguments: a pattern, and a set of files to search.</p>

<p>When we ran the <code>vimgrep</code> command a minute ago, we supplied the <code>%</code> symbol, which is a special symbol that represents the filepath of the active buffer. Note the elipsis in the documentation. This indicates that we can supply the path to more than one file and the <code>vimgrep</code> command will search the contents of each one.</p>

<p>Let&rsquo;s try that out. This directory contains 3 markdown files. We&rsquo;ll use <code>vimgrep</code> to search through all of them. For starters, we&rsquo;ll hardcode the explicit filepath for each file:</p>
<pre class="highlight plaintext">:vim /\v`[^`]*`/g abstract.md script.md shownotes.md
</pre>

<p>That seems to have worked. Our quickfix list now contains 24 results. If we advance through the list, you&rsquo;ll see that it traverses the three specified files.</p>

<p>But we don&rsquo;t have to spell out the filepaths one by one. Instead, we could use a wildcard:</p>
<pre class="highlight plaintext">:vim /pattern/ *.md
</pre>

<p>Which produces the same result.</p>

<p>Or, we could even use a backtick expression!</p>
<pre class="highlight plaintext">:vim /pattern/ `find . -type f`
</pre>

<p>Which also has the same effect.</p>

<p>To recap, we can provide</p>

<ul>
<li>one or more filepaths</li>
<li>a wildcard</li>
<li>or a backtick expression</li>
</ul>

<p>Does that sound familiar? If you&rsquo;ve watched episode 42, then you&rsquo;ll recognise these as being the same arguments that we can use to populate the arglist.</p>

<p>But get this: there&rsquo;s one additional argument that can be passed to the <code>vimgrep</code> command: <code>##</code> (double-hash).</p>
<pre class="highlight plaintext">:help ##
</pre>

<p>This is a special symbol that represents the set of files in the arglist. It&rsquo;s really handy in this context. Suppose that we wanted to search the same set of files for one pattern, then another pattern, and so on. It would be a drag to have to specify the same set of files again and again:</p>
<pre class="highlight plaintext">:vim /pattern1/ *.md
:vim /pattern2/ *.md
:vim /pattern3/ *.md
</pre>

<p>We can avoid this repetition by populating the arglist with the set of files we want to work with, then using the special symbol <code>##</code> (double hash) to reference the arglist:</p>
<pre class="highlight plaintext">:args *.md
:vim /pattern1/ ##
:vim /pattern2/ ##
:vim /pattern3/ ##
</pre>

<p>Not having to think about which files you&rsquo;re dealing with frees you up to focus on the more interesting part of the <code>vimgrep</code> command: the pattern.</p>

<h2>Specifying the pattern</h2>

<p>The pattern field behaves more or less as you would expect. You can supply any pattern that would work with Vim&rsquo;s standard search command. However, there is one irregularity to watch out for.</p>

<p>If we run the <code>vimgrep</code> command with a blank pattern, it doesn&rsquo;t do what you might expect.</p>
<pre class="highlight plaintext">:vim //g %
</pre>

<p>This has created a match for every single character in the file, which is unfortunate. It would be nice if this worked the same way as the <code>substitute</code> and <code>global</code> commands. If you leave the pattern blank for either of these commands, then they automatically use the most recent search pattern.</p>

<p>If you want to use the last search pattern with <code>vimgrep</code>, there is a way: on the command line, control-r followed by forward slash will insert the last search pattern. So we can type &ldquo;vim slash, control-R slash&rdquo;, then close the search field and finish off the command:</p>
<pre class="highlight plaintext">:vim /&lt;C-r&gt;//g %
</pre>

<p>You may have noticed that throughout this demo, I&rsquo;ve always included the <code>g</code> flag after the search field. Without this flag, <code>vimgrep</code> would only match the first occurrence on each line where the pattern appears.</p>

<h2>Pros and cons</h2>

<p>If you want to search a large codebase and get results fast, then you&rsquo;d be better off using an tool like <code>git-grep</code>, <code>ack</code> or the silver searcher. All of these external tools integrate with the quickfix list, and you can find Vim plugins for each of them.</p>

<p>Vimgrep won&rsquo;t produce results as quickly as these external tools, but it&rsquo;s still useful. I reach for <code>vimgrep</code> when I want to use Vim&rsquo;s built-in regex engine. I love being able to test my regular expression in one buffer using the search command, then use the same pattern without modification to search across the entire project. For me, that convenience is the killer feature of <code>vimgrep</code>.</p>


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>
