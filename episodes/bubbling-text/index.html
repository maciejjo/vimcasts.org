<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Bubbling text</title>

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_bubbling-text episodes_bubbling-text_index">

  <div class="off-canvas-wrap">
    <div class="inner-wrap">
      <nav class="top-bar show-for-large-up" data-topbar>
        <ul class="title-area">
          <li class="name">
            <h1><a href="/">Vimcasts</a></h1>
          </li>
          <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
        </ul>

        <section class="top-bar-section">
          <!-- Right Nav Section -->
          <ul class="right">
            <li class="has-form">
            <div class="row collapse">
              <div class="large-8 small-9 columns">
                <input type="text" placeholder="Explore archives">
              </div>
              <div class="large-4 small-3 columns">
                <a href="#" class="alert button expand">Search</a>
              </div>
            </div>
            </li>
          </ul>

          <!-- Left Nav Section -->
          <ul class="left">
          <li><a href="/categories">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          </ul>
        </section>
      </nav>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/">Home</a></li>
          <li><a href="/episodes">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          <li>
          <form>
            <label text="search">Search: <input type="search" disabled/></label>
          </form>
          </li>
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="show-for-small-only text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil</small>
            </h4>
            <h4 class="show-for-medium-up text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical Vim</a></small>
            </h4>
            
          </div>
        </div>

        <p>TextMate has a few built in commands for moving selected text around a document. The end end result of using these commands can be achieved by cutting and pasting, but the visual feedback they provide is quite helpful. In this episode, I will show how to replicate these commands in Vim.</p>

<p></p>

<p>In TextMate, the commands for moving selected text can be found under the "Text &gt; Move Selection" menu. I find "move selected line up" to be an acurate but dull description. Personally, I prefer to call this feature <em>text bubbling</em>. </p>

<p><img alt="TextMate's Move selection commands" src="/images/blog/bubble-text.png" /></p>

<p>In the video, I describe two different ways of reproducing the text bubbling feature.</p>

<h2 id="text-bubble-with-vim-primitives">Text bubble with Vim primitives</h2>

<p>By putting the following in your <code>.vimrc</code> file, you can create maps for bubbling text up and down:</p>

<pre class="brush: vimscript">
&quot; Bubble single lines
nmap &lt;C-Up&gt; ddkP
nmap &lt;C-Down&gt; ddp
&quot; Bubble multiple lines
vmap &lt;C-Up&gt; xkP`[V`]
vmap &lt;C-Down&gt; xp`[V`]
</pre>

<h3 id="edge-cases">Edge cases</h3>

<p>These mappings have a flaw which is only apparent when you use them at the boundaries of a document. For example, if the cursor is placed on the last line of a file and you try to move it up by one line, instead it moves up by two lines. Remember that these mappings are blind, they just replay a series of keystrokes, without any understanding of context.</p>

<h2 id="text-bubble-with-unimpairedvim">Text bubble with unimpaired.vim</h2>

<p>A better solution is available if you install Tim Pope's <a href="http://www.vim.org/scripts/script.php?script_id=1590">unimpaired</a> plugin. This provides the <em>exchange</em> commands, which are mapped to <code>[e</code> and <code>]e</code> respectively:</p>

<pre><code>[e  -  Exchange the current line with [count] lines above it.
]e  -  Exchange the current line with [count] lines below it.
</code></pre>

<p>These commands can be prepended with a count, and they both also work in Visual mode. Whatsmore, they handle edgecases more gracefully, by raising an error message: <strong>Invalid address</strong>.</p>

<p>If you have the unimpaired plugin installed, then you can use the "square bracket e" commands to bubble text up and down. But if you are used to the TextMate key commands, you could always recreate those mappings and hook into the commands from unimpaired. This excerpt of Vimscript should do it:</p>

<pre class="brush: vimscript">
&quot; Bubble single lines
nmap &lt;C-Up&gt; [e
nmap &lt;C-Down&gt; ]e
&quot; Bubble multiple lines
vmap &lt;C-Up&gt; [egv
vmap &lt;C-Down&gt; ]egv
</pre>

<h2 id="visually-select-the-last-edited-text">Visually select the last edited text</h2>

<p>You may already know that <a href="http://vimdoc.sourceforge.net/htmldoc/visual.html#gv"><code>gv</code></a> can be used to start visual mode with the same selection as last time visual mode was used. If you have cut and pasted a visual selection, then this doesn't work the way that you would expect. Fortunately, you can visually select the text from the last edit by jumping to the first and last characters with the motions <code>\</code>[<code> and </code>`]`.</p>

<p>I keep the following mapping in my <code>.vimrc</code>:</p>

<pre class="brush: vimscript">
" Visually select the text that was last edited/pasted
nmap gV `[v`]
</pre>

<p>So with <code>gv</code> I can reselect the last visual selection, and with <code>gV</code> I can visually select the text that was most recently edited or pasted.</p>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/visual.html#gv"><code>:help gv</code></a> - reselect last visual selection</li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#'["><code>:help \`[</code></a> - go to first character of latest edit</li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/motion.html#']"><code>:help \`]</code></a> - go to last character of latest edit</li>
  <li><a href="http://www.vim.org/scripts/script.php?script_id=1590">unimpaired.vim</a> - a plugin by Tim Pope (<a href="http://github.com/tpope/vim-unimpaired">source on github</a>)</li>
</ul>


      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>


    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
