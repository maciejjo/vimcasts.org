
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>An introduction to vspec</title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_an-introduction-to-vspec episodes_an-introduction-to-vspec_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

      
    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

    </div>

    <div class="small-4 column">
      
    </div>
  </div>

</div>



      <header>
        <h2>An introduction to vspec</h2>
        <div class="episode_number">
          <small>#</small>50
        </div>
        <time pubdate="pubdate" datetime="2013-06-17">
          Jun 17, 2013
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P7M,15S">
            7:15
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/vimscript">vimscript</a>, <a href="/categories/testing">testing</a>, <a href="/categories/plugins">plugins</a>
          </div>
        
      </header>

      <div data-swiftype-index="true">
        <p><a href="https://github.com/kana/vim-vspec">Vspec</a> is a library that allows you to test-drive your Vimscript code. In this tutorial, we'll cover the basics: how to inspect the contents of a buffer, how to simulate the actions of a user, and how to invoke user-defined mappings.</p>


      </div>

      <video poster="http://vimcasts.org/images/posters/vspec-intro.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_50_placeholder">
        <source src="http://media.vimcasts.org/videos/50/vspec_intro.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/50/vspec_intro.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          <a href="http://media.vimcasts.org/videos/50/vspec_intro.ogv">OGG</a>
          <span class="stats">12.9 MB</span>
          </li>

          <li class="quicktime">
          <a href="http://media.vimcasts.org/videos/50/vspec_intro.m4v">Quicktime</a>
          <span class="stats">18 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/50/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content" data-swiftype-index="true">
          

<p>Vspec lets you write tests for you Vimscript code, following a format that resembles <a href="https://github.com/rspec/rspec">rspec</a>. We can use a <code>describe</code> block to specify a context, then wrap each individual test in an <code>it</code> block. Each of these blocks is closed with an <code>end</code> keyword, just like in ruby:</p>

<pre><code>describe 'vspec'
  it 'is inspired by rspec'
  end
end
</code></pre>

<p>Check out Kana Natsuno's blog post for instructions on <a href="http://whileimautomaton.net/2013/02/13211500">how to set up a Vim plugin to be tested by vspec</a>.</p>

<h3 id="sample-code">Sample code</h3>

<p>Here's the vspec code that was demonstrated in the video:</p>

<pre><code>nnoremap x daw

describe 'vspec'

  before
    new
    put! = 'Welcome to Vimcasts'
  end

  after
    close!
  end

  it 'can read the contents of the buffer'
    Expect getline(1) == "Welcome to Vimcasts"
  end

  it 'feels just like operating Vim!'
    normal gg$
    normal daw
    Expect getline(1) == 'Welcome to'
    Expect getreg('"') == ' Vimcasts'
  end

  it 'can exercise user-defined mappings'
    normal gg$
    normal x
    Expect getline(1) == 'Welcome to'
    Expect getreg('"') == ' Vimcasts'
  end

end
</code></pre>

<h3 id="normal-vs-normal">:normal Vs :normal!</h3>

<p>In the demo, I used the <a href="http://vimdoc.sourceforge.net/htmldoc/various.html#:normal"><code>:normal</code> command</a>. It's worth noting that the <code>:normal!</code> command, when used with a trailing bang, will avoid user-defined mappings. That's useful if you want to invoke built-in functionality. For example, if we had used <code>:normal! x</code> in our vspec test, then it would have invoked <a href="http://vimdoc.sourceforge.net/htmldoc/change.html#x">Vim's built-in <code>x</code> command</a>, ignoring our custom mapping.</p>

<p>In <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/29.html">Learn Vimscript the Hard Way</a>, Steve Losh says "when writing Vim scripts you should always use normal!, and never use plain old normal". This is good advice when writing plugin functionality, but you can disregard it when writing vspec tests for that same plugin. If you want to test the functionality of a user-defined mapping, then <code>:normal</code> (without the bang) is the way to do it.</p>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="https://github.com/kana/vim-vspec">vspec on github</a></li>
  <li><a href="http://whileimautomaton.net/2013/02/13211500">Kana's introduction to vspec</a></li>
  <li><a href="http://whileimautomaton.net/2013/02/08211255">Set up continuous integration for a Vim plugin using Travis</a></li>
  <li><a href="http://learnvimscriptthehardway.stevelosh.com/">Learn Vimscript the Hard Way</a>, by Steve Losh</li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#:put"><code>:help :put</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/various.html#:normal"><code>:help :normal</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/eval.html#getline()"><code>:help getline()</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/eval.html#getreg()"><code>:help getreg()</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/windows.html#:new"><code>:help :new</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/windows.html#:close"><code>:help :close</code></a></li>
</ul>


        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>

      <div>
        <hr/>
        <h3>Related content</h3>
        <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">
          <li>
          <h4><a href="/episodes/refining-search-patterns-with-the-command-line-window/">Refining search patterns with the command-line window</a></h4>
          <p>
          When you need to build a complex command, or devise a non-trivial search pattern, Vim’s command-line mode can be rather limiting. In this episode, I will introduce the command-line window, which allows you to use the full power of Vim when editing search queries and commands.
          </p>
          </li>
          <li>
          <h4><a href="/episodes/fugitive-vim-working-with-the-git-index/">Fugitive.vim - working with the git index</a></h4>
          <p>
          The fugitive plugin provides an interactive status window, where you can easily stage and review your changes for the next commit. The :Gdiff command visualizes the changes made to a file, by comparing the working copy with the index. In this episode, we’ll learn how to stage hunks of changes to the index without using the git add --patch command.
          </p>
          </li>
          <li>
          <h4><a href="/blog/2013/02/habit-breaking-habit-making/">Habit making, habit breaking</a></h4>
          <p>
          Moving your Vim cursor around using the arrow keys is a bad habit, and like many bad habits it’s a difficult one to break!
          </p>
          </li>
          <li>
          <h4><a href="/training">Vim Training</a></h4>
          <p>Boost your productivity with a <a href="/training">Vim training class</a>. Join a public class, or <a href="/training/private">book a private session</a> for your team.</p>
          </li>
          <li>
          <h4><a href="/publications">Publications</a></h4>
          <p>
          Make yourself a faster and more efficient developer with the help of <a href="/publications">these publications</a>.
          </p>
          </li>
          <li>
          <h4><a href="/categories">Find by category</a></h4>
          <p>
          Vimcasts contains
          65 free screencasts and
          45 articles.
          <a href="/categories">Browse all content by category</a>.
          </p>
          </li>
        </ul>
      </div>

      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>

