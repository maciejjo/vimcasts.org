<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title></title>

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_62 episodes_62_transcript episodes_62_transcript_index">

  <div class="off-canvas-wrap">
    <div class="inner-wrap">
      <nav class="top-bar show-for-large-up" data-topbar>
        <ul class="title-area">
          <li class="name">
            <h1><a href="/">Vimcasts</a></h1>
          </li>
          <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
        </ul>

        <section class="top-bar-section">
          <!-- Right Nav Section -->
          <ul class="right">
            <li class="has-form">
            <div class="row collapse">
              <div class="large-8 small-9 columns">
                <input type="text" placeholder="Explore archives">
              </div>
              <div class="large-4 small-3 columns">
                <a href="#" class="alert button expand">Search</a>
              </div>
            </div>
            </li>
          </ul>

          <!-- Left Nav Section -->
          <ul class="left">
          <li><a href="/categories">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          </ul>
        </section>
      </nav>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li><a href="/">Home</a></li>
          <li><a href="/episodes">Episodes</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/training">Training</a></li>
          <li><a href="/publications">Publications</a></li>
          <li>
          <form>
            <label text="search">Search: <input type="search" disabled/></label>
          </form>
          </li>
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="show-for-small-only text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil</small>
            </h4>
            <h4 class="show-for-medium-up text-right">
              Free Vim screencasts<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical Vim</a></small>
            </h4>
            
          </div>
        </div>

        <h1 id="creating-mappings-that-accept-a-count">Creating mappings that accept a count</h1>

<p>Lots of Vim's built-in Normal mode commands can be executed multiple times by prefixing them with a count. User-defined Normal mode mappings don't usually handle counts the way you might like them to. We'll explore a couple of techniques for making your custom mappings respond predictably to a count.</p>

<p>Here's a task that I find myself performing often: I'll search for the word 'Intro', change it to something else, then repeat the same edit a handful of times by pressing <code>n.</code> (N-dot) again and again. That's two keystrokes per change. What if we could collapse that down to a single keystroke?</p>

<p>I don't like the built-in behaviour of the <code>Q</code> (shift-Q) command, so I like to map it to something more useful. Let's set up a Normal mode mapping so that pressing shift-Q executes N-dot:</p>

<pre><code>nnoremap Q n.
</code></pre>

<p>I'll write that file, then source it. 
Now let's try out our mapping.
I'll search for the word 'Welcome', then change it back to 'Intro'. Now each time that I press shift-Q, Vim jumps to the next match and repeats the last change.</p>

<p>I'll just undo each of those changes and we'll try something different.</p>

<p>I've got search-highlighting enabled, and I can tell at a glance that I'm going to want to repeat this change FOUR times in total. Many of Vim's commands can be prefixed with a count. Let's try using a count of FOUR with our custom mapping.</p>

<p>See what's happened? The <code>n</code> command has been repeated FOUR times, but the dot command was only executed one time. It would be nice if we could fix our custom mapping so that the count applied to everything, not just the very next command.</p>

<p>Here's one way of making this work:</p>

<pre><code>nnoremap Q @='n.'&lt;CR&gt;
</code></pre>

<p>I'll write the file, then source it, now let's try our revised mapping. I'll repeat my search for 'Welcome', change it to 'Intro', then press <code>3Q</code>. Sure enough, the count has caused the change to be applied to the next 3 occurrences.</p>

<p>So how does it work? The <code>@</code> key tells Vim to execute a macro. Rather than using a named register, we use the expression register, which let's us specify the contents in place. The characters inside of the quotes are interpreted as keystrokes, and the carriage return enters the string into the expression register. When we execute this with a count, it applies to the entire macro, not just the very next command.</p>

<p>It's a pretty neat trick, but it can look a bit cryptic inside a vimrc file! Here's an alternative method, which I find slightly easier on the eye:</p>

<pre><code>nnoremap Q :normal n.&lt;CR&gt;
</code></pre>

<p>This uses the <code>:normal</code> Ex command to execute n-dot. I'll write and source the file, and quickly demonstrateâ€¦ Again, this mapping works fine with a count.</p>

<p>As an exercise, why don't you go through any Normal mode mappings you've got in your vimrc and ask yourself: "could this be improved by being made to accept a count?" If the answer is yes, then I suggest that you modify the mapping to use one of these patterns.</p>

      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>


    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>
