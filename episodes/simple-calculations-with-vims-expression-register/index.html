
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Simple calculations with Vim's expression register</title>

    
      <meta name="st:robots" content="follow, index">
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_simple-calculations-with-vims-expression-register episodes_simple-calculations-with-vims-expression-register_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form"><input type="search" placeholder="Search the archives"/></form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form"><input type="search" placeholder="Search the archives"/></form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
I'll be teaching my Core Vim Class Online on March 5th.
</p>

      <a href="https://ti.to/studio-nelstrom/core-vim-class-online-4" class="button expand">Book now</a>

    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
I'll be teaching my Core Vim Class Online on March 5th.
</p>

    </div>

    <div class="small-4 column">
      <a href="https://ti.to/studio-nelstrom/core-vim-class-online-4" class="button expand">Book now</a>

    </div>
  </div>

</div>



      <header>
        <h2>Simple calculations with Vim's expression register</h2>
        <div class="episode_number">
          <small>#</small>56
        </div>
        <time pubdate="pubdate" datetime="2013-10-16">
          Oct 16, 2013
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P4M,02S">
            4:02
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/registers">registers</a>, <a href="/categories/expression-register">expression-register</a>, <a href="/categories/insert-mode">insert-mode</a>, <a href="/categories/cmdline-mode">cmdline-mode</a>
          </div>
        
      </header>

      <div data-swiftype-index="true">
        <p>The <a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote=">expression register</a> lets us evaluate a snippet of Vimscript code. This is handy when you need to perform simple calculations and insert the result into the document.</p>


      </div>

      <video poster="http://vimcasts.org/images/posters/expression-register-maths.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_56_placeholder">
        <source src="http://media.vimcasts.org/videos/56/expression-register.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/56/expression-register.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          <a href="http://media.vimcasts.org/videos/56/expression-register.ogv">OGG</a>
          <span class="stats">4.5 MB</span>
          </li>

          <li class="quicktime">
          <a href="http://media.vimcasts.org/videos/56/expression-register.m4v">Quicktime</a>
          <span class="stats">7.9 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/56/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content" data-swiftype-index="true">
          

<p>From Insert mode, pressing <code>&lt;C-r&gt;=</code> drops us into the <a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote=">expression register</a>. We can enter any Vimscript expression. On pressing Enter, Vim evaluates the expression, and inserts the result into the document. For example, if we entered  <code>2*21</code> into the expression register, Vim would insert <code>42</code> into the document.</p>

<p>In general, we can think of Vim's registers as being variables that hold a string of text, but the <a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote=">expression register</a> is different. This register behaves like a scratchpad that lets us evaluate Vimscript code. If the return value is a string, or if it can be coerced to a string, then Vim will use the result just as though it had been retrieved from any other register.</p>

<p>When we dial up the expression register, Vim drops us into Commandline mode. Usually, Vim's command-line uses a colon as the prompt, which lets us run an Ex command. But in this context the prompt is an equals sign, which tells us we're in the expression register. All of the functionality that is usually present in Commandline mode is available to us in the expression register, including the <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R"><code>&lt;C-r&gt;{reg}</code> command</a>.</p>

<h3 id="creating-a-mapping-to-perform-calculations">Creating a mapping to perform calculations</h3>

<p>In the video, I created a mapping on-the-fly to speed up the task of inserting the results of calculations into the document. Here's the mapping:</p>

<pre><code>nnoremap Q 0yt=A&lt;C-r&gt;=&lt;C-r&gt;"&lt;CR&gt;&lt;Esc&gt;
</code></pre>

<p>This sets up the <code>Q</code> key to perform all of the following work:</p>

<table>
<tr>
<th>command</th>
<th>effect</th>
</tr>
<tr>
<td><code>0</code></td>
<td>move to the start of the line</td>
</tr>
<tr>
<td><code>yt=</code></td>
<td>yank from cursor position up to (but not including) the `=` sign</td>
</tr>
<tr>
<td><code>A</code></td>
<td>move to end of line and switch to Insert mode</td>
</tr>
<tr>
<td><code>&lt;C-r&gt;=</code></td>
<td>dial up the expression register</td>
</tr>
<tr>
<td><code>&lt;C-r&gt;&quot;</code></td>
<td>paste the contents of the default register into the command line</td>
</tr>
<tr>
<td><code>&lt;CR&gt;</code></td>
<td>evaluate the expression register and insert the result into the document</td>
</tr>
<tr>
<td><code>&lt;Esc&gt;</code></td>
<td>return to Normal mode</td>
</tr>
</table>

<p>This mapping is specialized for one particular task, so I wouldn't save it in my vimrc. Instead, I would just create this macro on-the-fly as a throwaway helper to get me through the task at hand.</p>

<p>This is the final command that I demonstrated:</p>

<pre><code>:'&lt;,'&gt;normal Q
</code></pre>

<p>You can read this as follows:</p>

<ul>
  <li><code>:'&lt;,'&gt;</code> for each selected line</li>
  <li><code>normal Q</code> execute the Normal mode <code>Q</code> command, using any user-defined mappings</li>
</ul>

<p>For a discussion of the <code>:normal</code> and <code>:normal!</code> commands, check out <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/29.html">chapter 29</a> of Steve Losh's Learn Vimscript the Hard Way. Steve suggests always using <code>:normal!</code> and avoiding <code>:normal</code>, which is good advice when writing a script, but it doesn't apply in this situation. Think about it!</p>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/insert.html#i_CTRL-R"><code>:h i_ctrl-r</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote="><code>:h quote=</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/eval.html#expression"><code>:h expression</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/usr_41.html#usr_41.txt"><code>:h usr_41.txt</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/various.html#:norm"><code>:h :normal</code></a></li>
  <li><a href="http://learnvimscriptthehardway.stevelosh.com/chapters/29.html">Chapter 29</a>, Learn Vimscript the Hard Way</li>
</ul>


        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>

      <div>
        <hr/>
        <h3>Related content</h3>
        <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">
          <li>
          <h4><a href="/episodes/refining-search-patterns-with-the-command-line-window/">Refining search patterns with the command-line window</a></h4>
          <p>
          When you need to build a complex command, or devise a non-trivial search pattern, Vim’s command-line mode can be rather limiting. In this episode, I will introduce the command-line window, which allows you to use the full power of Vim when editing search queries and commands.
          </p>
          </li>
          <li>
          <h4><a href="/episodes/fugitive-vim-working-with-the-git-index/">Fugitive.vim - working with the git index</a></h4>
          <p>
          The fugitive plugin provides an interactive status window, where you can easily stage and review your changes for the next commit. The :Gdiff command visualizes the changes made to a file, by comparing the working copy with the index. In this episode, we’ll learn how to stage hunks of changes to the index without using the git add --patch command.
          </p>
          </li>
          <li>
          <h4><a href="/blog/2013/02/habit-breaking-habit-making/">Habit making, habit breaking</a></h4>
          <p>
          Moving your Vim cursor around using the arrow keys is a bad habit, and like many bad habits it’s a difficult one to break!
          </p>
          </li>
          <li>
          <h4><a href="/training">Vim Training</a></h4>
          <p>Boost your productivity with a <a href="/training">Vim training class</a>. Join a public class, or <a href="/training/private">book a private session</a> for your team.</p>
          </li>
          <li>
          <h4><a href="/publications">Publications</a></h4>
          <p>
          Make yourself a faster and more efficient developer with the help of <a href="/publications">these publications</a>.
          </p>
          </li>
          <li>
          <h4><a href="/categories">Find by category</a></h4>
          <p>
          Vimcasts contains
          65 free screencasts and
          45 articles.
          <a href="/categories">Browse all content by category</a>.
          </p>
          </li>
        </ul>
      </div>

      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

    <script type="text/javascript">
var Swiftype = window.Swiftype || {};
  (function() {
    Swiftype.key = 'Wdx4LxrBJv86q28yDA8A';
    Swiftype.renderStyle = 'new_page';
    Swiftype.resultPageURL = '/results/index.html';

    /** DO NOT EDIT BELOW THIS LINE **/
    var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
    script.src = "//s.swiftypecdn.com/embed.js";
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
  }());
</script>

    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>

