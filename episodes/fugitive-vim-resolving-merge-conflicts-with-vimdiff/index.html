<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Fugitive.vim - resolving merge conflicts with vimdiff</title>

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_fugitive-vim-resolving-merge-conflicts-with-vimdiff episodes_fugitive-vim-resolving-merge-conflicts-with-vimdiff_index">

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">
            <!-- Right Nav Section -->
            <ul class="right">
              <li class="has-form">
              <div class="row collapse">
                <div class="large-8 small-9 columns">
                  <input type="text" placeholder="Explore archives">
                </div>
                <div class="large-4 small-3 columns">
                  <a href="#" class="alert button expand">Search</a>
                </div>
              </div>
              </li>
            </ul>

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


          <li>
          <form>
            <label text="search">Search: <input type="search" disabled/></label>
          </form>
          </li>
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
I'll be teaching my Core Vim Class Online on March 5th.
</p>

      <a href="https://ti.to/studio-nelstrom/core-vim-class-online-4" class="button expand">Book now</a>

    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
I'll be teaching my Core Vim Class Online on March 5th.
</p>

    </div>

    <div class="small-4 column">
      <a href="https://ti.to/studio-nelstrom/core-vim-class-online-4" class="button expand">Book now</a>

    </div>
  </div>

</div>



      <header>
        <h2>Fugitive.vim - resolving merge conflicts with vimdiff</h2>
        <div class="episode_number">
          <small>#</small>33
        </div>
        <time pubdate="pubdate" datetime="2011-05- 6">
          May  6, 2011
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P11M,35S">
            11:35
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/plugins">plugins</a>, <a href="/categories/fugitive">fugitive</a>, <a href="/categories/git">git</a>, <a href="/categories/workflow">workflow</a>, <a href="/categories/vimdiff">vimdiff</a>
          </div>
        
      </header>

      <p>When git branches are merged, there is always the chance of a conflict arising if a file was modified in both the target and merge branches. You can resolve merge conflicts using a combination of fugitive's <code>:Gdiff</code> command, and Vim's built in <code>diffget</code> and <code>diffput</code>. In this episode, we'll find out how.</p>

<p><em>This is the third in a five part series on fugitive.vim.</em></p>

<p>

      <video poster="/images/posters/fugitive_3.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_33_placeholder">
        <source src="http://media.vimcasts.org/videos/33/fugitive_3.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/33/fugitive_3.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          
          <a href="http://media.vimcasts.org/videos/33/fugitive_3.ogv">OGG</a>
          <span class="stats">16.9 MB</span>
          </li>

          <li class="quicktime">
          
          <a href="http://media.vimcasts.org/videos/33/fugitive_3.m4v">Quicktime</a>
          <span class="stats">22.7 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/33/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content">
          <p>When git branches are merged, there is always the chance of a conflict arising if a file was modified in both the target and merge branches. You can resolve merge conflicts using a combination of fugitive's <code>:Gdiff</code> command, and Vim's built in <code>diffget</code> and <code>diffput</code>. In this episode, we'll find out how.</p>

<p><em>This is the third in a five part series on fugitive.vim.</em></p>

<p></p>

<h3 id="gdiff-on-a-conflicted-file-opens-3-way-diff"><code>:Gdiff</code> on a conflicted file opens 3-way diff</h3>

<p>When you run <code>:Gdiff</code> on a conflicted file, fugitive opens 3 split windows. They always appear in this order:</p>

<ul>
  <li>the left window contains the version from the target branch</li>
  <li>the middle window contains the working copy of the file, complete with conflict markers</li>
  <li>the right window contains the version from the merge branch</li>
</ul>

<p><img alt="3-way vimdiff splits" src="/images/blog/3-way-vimdiff.png" /></p>

<p>I discuss <em>target</em> and <em>merge</em> branches a lot in the screencast, so lets just make sure that we're on the same page. The 'target' branch is the one that is active when you run git merge. Or in other words, it's the HEAD branch. The 'merge' branch is the one that is named in the <code>git merge</code> command. In this scenario the 'master' branch is the target, and the 'feature' branch is merged into target, making it the merge branch.</p>

<p><img alt="Target and merge branches" src="/images/blog/target-merge-branches.png" /></p>

<h3 id="strategies-for-reconciling-3-way-diffs">Strategies for reconciling 3-way diffs</h3>

<p>There are two basic strategies for reconciling a 3-way diff. You can either keep your cursor in the middle file, and run <code>:diffget</code> with the bufspec for the file containing the change you want to keep. Or you can position your cursor on the change that you want to keep, and run <code>:diffput</code> with the bufspec for the working copy file. We'll take a look at each of these strategies in turn, starting with diffget.</p>

<p><img alt="3-way reconciliation strategies" src="/images/blog/3-way-reconciliation.png" /></p>

<h3 id="introducing-buffspecs">Introducing buffspecs</h3>

<p>In the context of a 2-way diff, the <code>:diffget</code> and <code>:diffput</code> commands are unambiguous. If you ask Vim to get the diff from the other window, there is only one place for it to look. When you do a 3-way merge, things get a little more complex. This time, it would be ambiguous if you were to tell Vim to fetch the changes from the other window. You have to specify which buffer to fetch the changes from by providing a <code>[bufspec]</code>.</p>

<p>The buffspec could either be the buffer number, or a partial match for the buffer's name. Buffer numbers are assigned sequentially, so they will differ from session to session, but you can always be sure that they will uniquely identify their buffer.</p>

<p>Fugitive follows a consistent naming convention when creating buffers for the target and merge versions of a conflicted file. The parent file from the <em>target branch</em> always includes the string <code>//2</code>, while the parent from the <em>merge branch</em> always contains <code>//3</code>. These partial matches are sufficient to uniquely identify the target and merge parents when using the <code>:diffget</code> command.</p>

<table>
  <tr>
    <th>parent version</th>
    <th>buffspec</th>
  </tr>
  <tr>
    <td>target</td>
    <td><code>//2</code></td>
  </tr>
  <tr>
    <td>merge</td>
    <td><code>//3</code></td>
  </tr>
</table>

<h3 id="resolving-a-3-way-diff-with-diffget">Resolving a 3-way diff with <code>:diffget</code></h3>

<p>The <code>:diffget</code> command modifies the current buffer by <em>pulling</em> a change over from one of the other buffers. In resolving a merge conflict, we want to treat target and merge parents as reference copies, pulling hunks of changes from those into the conflicted working copy. That means that we want to keep the middle buffer active, and run <code>diffget</code> with a reference to the buffer containing the change that we want to use. </p>

<ul>
  <li><code>:diffget //2</code> - fetches the hunk from the target parent (on the left)</li>
  <li><code>:diffget //3</code> - fetches the hunk from the merge parent (on the right)</li>
</ul>

<p>Note that Vim does not automatically recalculate the diff colors after you run <code>:diffget</code>. You can tell Vim to do this by running <code>:diffupdate</code>.</p>

<h3 id="resolving-a-3-way-diff-with-diffput">Resolving a 3-way diff with <code>:diffput</code></h3>

<p>The <code>:diffput</code> command modifies another buffer by <em>pushing</em> a change from the active buffer into it. In the context of a 3-way merge conflict, we want to push changes from the target and merge versions into the working copy.</p>

<p>The example in the video used a file called <code>demo.js</code>, which could be referenced using the buffspec <em>'demo'</em>. In this case, we could run the exact same command each time:</p>

<ul>
  <li><code>:diffput demo</code> - pushes the hunk from the active buffer into the conflicted working copy</li>
</ul>

<p>Although the command is kept constant, we have to activate the correct window before running it. Whereas using <code>diffget</code>, the window remained constant but we had to pass a different argument each time.</p>

<p>In a 2-way diff, the diffget and diffput commands require no argument. Vim provides a couple of convenient shorthand mappings for these commands: <code>do</code> performs a <code>diffget</code>, and <code>dp</code> does <code>diffput</code>. These mappings don't normally work in a 3-way diff, because the <code>diffget</code> and <code>diffput</code> commands both require an argument in this context. But in the case of the <code>diffput</code> command, it's pretty easy to guess what that argument is going to be.</p>

<p>When you do a 3-way diff between working copy, target and merge parents, fugitive assumes that if you run <code>dp</code> from either of the parent buffers, you want to put the change into the working copy. So even though the <code>dp</code> mapping normally only works in a 2-way diff, you can use it in this special case of a 3-way diff.</p>

<h3 id="keeping-one-parent-version-in-its-entirety">Keeping one parent version in its entirety</h3>

<p>In reality, it's often the case that one of the parent versions is to be kept wholesale, and the other version is to be discarded. In this scenario, fugitive's <code>:Gwrite</code> command comes in handy. This overwrites the working tree and index copies with the contents of the currently active file.</p>

<p>If you run <code>:Gwrite</code> from the target or merge version of a file, fugitive raises a warning. This is to protect you from accidentally overwriting the working copy and index files when you've carefully cherry picked the changes from the parent versions. If you want to stage either of the parent versions in their entirety, use <code>:Gwrite!</code> to show you really mean it.</p>

<h3 id="useful-commands">Useful commands</h3>

<p>This table summarizes some of the commands used in the video:</p>

<table>
  <tr>
    <th>command</th>
    <th>effect</th>
  </tr>
  <tr>
    <td><code>[c</code></td>
    <td>jump to previous hunk</td>
  </tr>
  <tr>
    <td><code>]c</code></td>
    <td>jump to next hunk</td>
  </tr>
  <tr>
    <td><code>dp</code></td>
    <td>shorthand for `:diffput`</td>
  </tr>
  <tr>
    <td><code>:only</code></td>
    <td>close all windows apart from the current one</td>
  </tr>
  <tr>
    <td><code>:Gwrite[!]</code></td>
    <td>write the current file to the index</td>
  </tr>
</table>

<p>The <code>dp</code> command normally only works in a two-way diff, as does <code>do</code>: the shorthand for <code>diffget</code>. </p>

<p>To leave <em>vimdiff</em> mode, you just need to close the windows that are being compared. The quickest way to do this is to run <code>:only</code> from the window that you want to keep open.</p>

<p>When you call <code>:Gwrite</code> from vimdiff mode, it writes the current file to the index and exits vimdiff mode.</p>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/usr_08.html#08.7"><code>:help 08.7</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/diff.html"><code>:help diff.txt</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/diff.html#:diffget"><code>:help :diffget</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/diff.html#:diffput"><code>:help :diffput</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/diff.html#jumpto-diffs"><code>:help [c</code></a></li>
  <li><code>:help :Gdiff</code></li>
  <li><a href="http://blog.wuwon.id.au/2010/09/painless-merge-conflict-resolution-in.html">Painless Merge Conflict Resolution in Git</a></li>
</ul>


        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>

      <div>
        <hr/>
        <h3>Related content</h3>
        <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">
          <li>
          <h4><a href="/episodes/refining-search-patterns-with-the-command-line-window/">Refining search patterns with the command-line window</a></h4>
          <p>
          When you need to build a complex command, or devise a non-trivial search pattern, Vim’s command-line mode can be rather limiting. In this episode, I will introduce the command-line window, which allows you to use the full power of Vim when editing search queries and commands.
          </p>
          </li>
          <li>
          <h4><a href="/episodes/fugitive-vim-working-with-the-git-index/">Fugitive.vim - working with the git index</a></h4>
          <p>
          The fugitive plugin provides an interactive status window, where you can easily stage and review your changes for the next commit. The :Gdiff command visualizes the changes made to a file, by comparing the working copy with the index. In this episode, we’ll learn how to stage hunks of changes to the index without using the git add --patch command.
          </p>
          </li>
          <li>
          <h4><a href="/blog/2013/02/habit-breaking-habit-making/">Habit making, habit breaking</a></h4>
          <p>
          Moving your Vim cursor around using the arrow keys is a bad habit, and like many bad habits it’s a difficult one to break!
          </p>
          </li>
          <li>
          <h4><a href="/training">Vim Training</a></h4>
          <p>Boost your productivity with a <a href="/training">Vim training class</a>. Join a public class, or <a href="/training/private">book a private session</a> for your team.</p>
          </li>
          <li>
          <h4><a href="/publications">Publications</a></h4>
          <p>
          Make yourself a faster and more efficient developer with the help of <a href="/publications">these publications</a>.
          </p>
          </li>
          <li>
          <h4><a href="/categories">Find by category</a></h4>
          <p>
          Vimcasts contains
          63 free screencasts and
          44 articles.
          <a href="/categories">Browse all content by category</a>.
          </p>
          </li>
        </ul>
      </div>

      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>


    <script src="/javascripts/all.js" type="text/javascript"></script>
  </body>
</html>

