
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>VimGolf - Prime Numbers</title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_vimgolf-prime-numbers episodes_vimgolf-prime-numbers_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

      
    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

    </div>

    <div class="small-4 column">
      
    </div>
  </div>

</div>



      <header>
        <h2>VimGolf - Prime Numbers</h2>
        <div class="episode_number">
          <small>#</small>36
        </div>
        <time pubdate="pubdate" datetime="2012-08-10">
          Aug 10, 2012
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P6M,53S">
            6:53
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/vimgolf">vimgolf</a>, <a href="/categories/showcase">showcase</a>, <a href="/categories/regex">regex</a>
          </div>
        
      </header>

      <div data-swiftype-index="true">
        <p>For the VimGolf challenge <a href="http://vimgolf.com/challenges/4d1c27940e3d7832db000010">&ldquo;List the first 100 prime numbers&rdquo;</a>, there&rsquo;s a solution that uses a regular expression to detect prime numbers. At 43 keystokes, it&rsquo;s not the winning solution, but I think it&rsquo;s the most interesting one. It uses a few clever Vim tricks, including macros, control-a to increment, the very magic pattern switch, and the <code>:global</code> command. There&rsquo;s a lot to learn from those 43 keystrokes, so let&rsquo;s study it!</p>


      </div>

      <video poster="http://vimcasts.org/images/posters/primes.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_36_placeholder">
        <source src="http://media.vimcasts.org/videos/36/primes.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/36/primes.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          <a href="http://media.vimcasts.org/videos/36/primes.ogv">OGG</a>
          <span class="stats">7 MB</span>
          </li>

          <li class="quicktime">
          <a href="http://media.vimcasts.org/videos/36/primes.m4v">Quicktime</a>
          <span class="stats">11 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/36/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content" data-swiftype-index="true">
          

<p>Here&rsquo;s the full solution (with a running keystroke tally):</p>

<table>
   <tr>
       <th>keystrokes</th>
       <th>tally</th>
   </tr>
   <tr>
       <td><code>C&lt;Tab&gt;1&lt;Esc&gt;</code></td>
       <td>4</td>
   </tr>
   <tr>
       <td><code>qw</code></td>
       <td>2</td>
   </tr>
   <tr>
       <td><code>&lt;C-a&gt;</code></td>
       <td>1</td>
   </tr>
   <tr>
       <td><code>&gt;&gt;</code></td>
       <td>2</td>
   </tr>
   <tr>
       <td><code>Yp</code></td>
       <td>2</td>
   </tr>
   <tr>
       <td><code>q</code></td>
       <td>1</td>
   </tr>
   <tr>
       <td><code>540@w</code></td>
       <td>5</td>
   </tr>
   <tr>
       <td><code>:g/\v^(&lt;Tab&gt;&lt;Tab&gt;+)\1+&lt;/d|%s/&lt;Tab&gt;*&lt;CR&gt;</code></td>
       <td>24</td>
   </tr>
   <tr>
       <td><code>ZZ</code></td>
       <td>2</td>
   </tr>
   <tr>
       <td><strong>total:</strong></td>
       <td>43</td>
   </tr>
</table>

<p>The <code>&lt;Tab&gt;</code> notation stands for the tab key, and <code>&lt;Esc&gt;</code> for the escape key. <code>&lt;C-a&gt;</code> stands for ctrl-a, and <code>&lt;CR&gt;</code> for carriage return, a.k.a. the enter key.</p>

<p>Try it out for yourself, and see if you can figure out how it works. You might consider the following explanation a spoiler.</p>

<h3>Strategy</h3>

<p>Here&rsquo;s the general strategy: we&rsquo;ll start by inserting the numbers 2, 3, 4, 5, and so on, up to 541, which is the one-hundredth prime number. Having inserted all of the numbers in this range, one per line, we&rsquo;ll then delete each line that contain a non-prime number. That should leave us with the first 100 prime numbers, and nothing else.</p>

<p>And here&rsquo;s the trick: we&rsquo;ll indent each line by a number of tabs that equals the value of the number on that line. For example, the line containing the number 2 will lead with 2 tab characters. The line containing the number 3 will lead with 3 tab characters. And so on. Then we can examine the length of the string with a regular expression.</p>

<h3>Insert numbers 2 up to 542</h3>

<p>Combining the [<code>ctrl-a</code>][] command with a macro lets us rapidly insert the numbers from 2 up to 542:</p>

<table>
   <tr>
       <th>keystrokes</th>
       <th>explanation</th>
   </tr>
   <tr>
       <td><code>C&lt;Tab&gt;1&lt;Esc&gt;</code></td>
       <td>insert a tab followed by 1</td>
   </tr>
   <tr>
       <td><code>qw</code></td>
       <td>start recording</td>
   </tr>
   <tr>
       <td><code>&lt;C-a&gt;</code></td>
       <td>increment the number</td>
   </tr>
   <tr>
       <td><code>&gt;&gt;</code></td>
       <td>insert a tab at the start of the line</td>
   </tr>
   <tr>
       <td><code>Yp</code></td>
       <td>duplicate the line</td>
   </tr>
   <tr>
       <td><code>q</code></td>
       <td>stop recording</td>
   </tr>
   <tr>
       <td><code>540@w</code></td>
       <td>execute the macro 540 times</td>
   </tr>
</table>

<h3>Delete all non-prime numbers</h3>

<p>The <code>:g/{pattern}/[cmd]</code> command allows us to execute the specified [cmd] on every line that matches the specified <code>{pattern}</code>. It can be used in this form to delete all non-prime numbers:</p>
<pre class="highlight plaintext">:g/\v^(&lt;Tab&gt;&lt;Tab&gt;+)\1+&lt;/d
</pre>

<p>Then we can flatten the remaining indentation with this substitute command:</p>
<pre class="highlight plaintext">:s/&lt;Tab&gt;*
</pre>

<p>Note that these two individual Ex commands can be combined into a single command-line, which saves a keystroke (this is VimGolf remember!):</p>
<pre class="highlight plaintext">:g/\v^(&lt;Tab&gt;&lt;Tab&gt;+)\1+&lt;/d|s/&lt;Tab&gt;*
</pre>

<h3>How does that regular expression work?</h3>

<p>The magic of the regex happens in this bit:</p>
<pre class="highlight plaintext">(&lt;Tab&gt;&lt;Tab&gt;+)\1+
</pre>

<p>Inside the parentheses, we match two or more tab characters. These are captured in a sub-match, and we can reference this sub-match using the <code>\1</code> notation. This bit of the pattern matches one or more occurrences of the original sub-match.</p>

<p>The <code>+</code> operator means &ldquo;one or more&rdquo; occurrences, and it performs a greedy match. That means it matches as many characters as it can. This diagram demonstrates how the regular expression inspects a string of 8 tab characters:</p>

<p><img alt="The regex finds that 4 is a factor of 8" src="/images/blog/regex-nonprime-8.png" /></p>

<p>The match indicates that 4 is a factor of 8, and therefore 8 is not a prime.</p>

<p>This diagram demonstrates how the same regex interacts with a string of 7 tab characters:</p>

<p><img alt="The regex finds no factors of 7, meaning it's a prime" src="/images/blog/regex-prime-7.png" /></p>

<p>There&rsquo;s no match, which indicates that 7 is a prime number.</p>

<h3 id="credit">Credit where due</h3>

<p>Thanks to <a href="https://twitter.com/federicogalassi">Federicco Galassi</a> for introducing me to this VimGolf solution. He credited it to <a href="https://twitter.com/_matthewd">Matthew Draper</a>, but Matthew says his solution was a refinement of the one posted by <a href="https://twitter.com/spamcow_moo">Glenn</a>. That seems to cover the history of this trick since it appeared on the VimGolf site, but the regex that forms the core of this solution has a much longer history.</p>

<p>This Perl one-liner was used in <a href="http://diswww.mit.edu/bloom-picayune.mit.edu/perl/7588">Abigail&rsquo;s email signature back in 1997</a>:</p>
<pre class="highlight plaintext">perl -wle 'print "Prime" if (1 x shift) =~ /^(?!(11+)\1+$)/'
</pre>

<p>That regex must have gained some notoriety. In this <a href="http://www.perlmonks.org/?node_id=81695">perlgolf &ldquo;Sieve of Erastosthenes&rdquo; challenge</a> (from 2001), it was referred to as <em>the infamous RE from Abigail</em>. I&rsquo;ve come across [several][] <a href="http://www.catonmat.net/blog/perl-regex-that-matches-prime-numbers/">explanations</a> of <a href="http://pages.cs.wisc.edu/~psilord/blog/9.html">how the Perl one-liner works</a>, as well as an article that points out <a href="http://zmievski.org/2010/08/the-prime-that-wasnt">its limitations</a>.</p>

<p>If you can fill in any more of the details in the history of this solution, please leave a comment below.</p>

<h3>Further reading</h3>

<ul>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#CTRL-A">&lt;C-a&gt;</a> to increment a number</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#q">q{register}</a> to record a macro</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#@">@{register}</a> to execute a macro</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#/v">\v</a> the verymagic pattern switch</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html#:g">:global</a> to perform an Ex command on each line matching a pattern</li>
<li><a href="http://vimgolf.com/challenges/4d1c27940e3d7832db000010">VimGolf: insert the first 100 prime numbers</a></li>
<li><a href="http://udioica.blogspot.co.uk/2013/11/its-factor-plus-little-prime-numbers.html">It&rsquo;s a factor</a> and an <a href="http://vimgolf.com/challenges/51459ef6b94aa50002000002">explanation of the solution</a></li>
</ul>

        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>


      <div>
  <hr/>
  <h3>Related content</h3>
  <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">

    
    

    
      <li>
        <h4><a href="/episodes/refining-search-patterns-with-the-command-line-window/">Refining search patterns with the command-line window</a></h4>
        <p>When you need to build a complex command, or devise a non-trivial search pattern, Vim&rsquo;s command-line mode can be rather limiting. In this episode, I will introduce the command-line window, which allows you to use the full power of Vim when editing search queries and commands.</p>


      </li>
    
      <li>
        <h4><a href="/publications">Publications</a></h4>
        <p>Make yourself a faster and more efficient developer with the help of <a href='/publications'>these publications</a>.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/search-for-the-selected-text/">Search for the selected text</a></h4>
        <p><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#star">The <code>*</code> command</a> searches for the word under the cursor. That makes sense in Normal mode, but from Visual mode it would be more useful if the star command searched for the current <em>selection</em>, rather than the current word. We can add this feature to Vim using the <a href="https://github.com/nelstrom/vim-visual-star-search">visual star search plugin</a>.</p>


      </li>
    
      <li>
        <h4><a href="/training">Vim Training</a></h4>
        <p>Boost your productivity with a <a href='/training'>Vim training class</a>. Join a public class, or <a href='/training/private'>book a private session</a> for your team.</p>
      </li>
    
      <li>
        <h4><a href="/categories">Find by category</a></h4>
        <p>Vimcasts contains 65 free screencasts and 45 articles. <a href='/categories'>Browse all content by category</a>.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/smart-search-with-subvert/">Smart search with :Subvert</a></h4>
        <p>The <code>:Subvert</code> command lets us create a particular style of regular expressions with ease. It&rsquo;s great for matching irregular singular and plural words in plain English and also for variable names that come in <code>snake_case</code> and <code>MixedCase</code> forms.</p>

<p><em>This is part one of a three-part series on Tim Pope&rsquo;s abolish plugin.</em></p>


      </li>
    

  </ul>
</div>


      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>

