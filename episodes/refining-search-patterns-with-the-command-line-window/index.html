
<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Refining search patterns with the command-line window</title>

    
      <meta name="st:robots" content="follow, index">
    

    
      <link href="/feeds/ogg" title="Vimcasts OGG Feed" rel="alternate" type="application/rss+xml" />
    
      <link href="/feeds/quicktime" title="Vimcasts Quicktime Feed" rel="alternate" type="application/rss+xml" />
    

    <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="episodes episodes_refining-search-patterns-with-the-command-line-window episodes_refining-search-patterns-with-the-command-line-window_index" data-swiftype-index='false'>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <div class="top-bar-underlay"></div>

      <div class="row">
        <nav class="top-bar show-for-large-up" data-topbar>
          <ul class="title-area">
            <li class="name">
              <h1><a href="/">Vimcasts</a></h1>
            </li>
            <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
          </ul>

          <section class="top-bar-section">

            
              <!-- Right Nav Section -->
              <ul class="right">
                <li class="has-form">
                <div class="row collapse">
                  <div class="large-12 columns">
                    <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


                  </div>
                </div>
                </li>
              </ul>
            

            <!-- Left Nav Section -->
            <ul class="left">
              <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>


            </ul>
          </section>
        </nav>
      </div>

      <nav class="tab-bar hide-for-large-up">
        <section class="left-small">
          <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
        </section>

        <section class="middle tab-bar-section"></section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Vimcasts</label></li>
          <li class="has-dropdown">
  <a href="/categories">Browse Vimcasts</a>
  <ul class="dropdown">
    <li><a href="/episodes">Latest episodes</a></li>
    <li><a href="/blog">Latest articles</a></li>
  </ul>
</li>
<li><a href="/training">Training</a></li>
<li><a href="/publications">Publications</a></li>



          
            <li>
              <form class="swiftype-search-form">
  <input type="search" class="swiftype-search-input" placeholder="Search the archives"/>
</form>


            </li>
          
        </ul>
      </aside>

      <section class="main-section">

        <div class="row identity-row">
          <div id="logo" class="small-4 columns">
            <h1>
              
                <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
              
            </h1>
          </div>
          <div class="small-7 small-offset-1 columns">
            
            <h4 class="text-right">
              Level-up your Vim<br/>
              <small>with Drew Neil, author of <a href="http://pragprog.com/book/dnvim/practical-vim">Practical&nbsp;Vim</a></small>
            </h4>
            
          </div>
        </div>

          <div class="row">
    <div class="small-12 columns">

      

<div class="row announcement-banner">
  <div class="small-12 column show-for-small-only">
    <div class="panel">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

      
    </div>
  </div>

  <div class="panel show-for-medium-up clearfix">
    <div class="small-8 column">
      <p>
            No Core Vim Classes are currently scheduled. <a href="#">Sign up to the mailing list</a> to hear of upcoming classes.
</p>

    </div>

    <div class="small-4 column">
      
    </div>
  </div>

</div>



      <header>
        <h2>Refining search patterns with the command-line window</h2>
        <div class="episode_number">
          <small>#</small>28
        </div>
        <time pubdate="pubdate" datetime="2010-11-21">
          Nov 21, 2010
        </time>
        <div class="video-duration">
          
          Run time: <time datetime="P7M,51S">
            7:51
          </time>
        </div>
        
          <div class="video-tags">
            Tagged with:
            <a href="/categories/search">search</a>, <a href="/categories/regex">regex</a>, <a href="/categories/workflow">workflow</a>
          </div>
        
      </header>

      <div data-swiftype-index="true">
        <p>When you need to build a complex command, or devise a non-trivial search pattern, Vim&rsquo;s command-line mode can be rather limiting. In this episode, I will introduce the command-line window, which allows you to use the full power of Vim when editing search queries and commands.</p>


      </div>

      <video poster="http://vimcasts.org/images/posters/commandline_window.png"
        controls="controls" preload="none" class="placeholder"
        id="episode_28_placeholder">
        <source src="http://media.vimcasts.org/videos/28/commandline_window.ogv" type="video/ogg" />
        <source src="http://media.vimcasts.org/videos/28/commandline_window.m4v" type="video/x-m4v" />
      </video>

      <aside class="downloads">
        <ul class="inline-list">
          <li>Download: </li>

          <li class="ogg">
          <a href="http://media.vimcasts.org/videos/28/commandline_window.ogv">OGG</a>
          <span class="stats">10 MB</span>
          </li>

          <li class="quicktime">
          <a href="http://media.vimcasts.org/videos/28/commandline_window.m4v">Quicktime</a>
          <span class="stats">13.4 MB</span>
          </li>

      </ul>

        <p>
          View a <a href="/transcripts/28/en/">transcript of the video</a>.
        </p>
      </aside>

      <dl class="accordion" data-accordion>
        <dd>
        <a href="#shownotes">Shownotes</a>
        <div id="shownotes" class="content" data-swiftype-index="true">
          

<h2>Commandline mode</h2>

<p>When you press <code>:</code> or <code>/</code> in Vim, you go into commandline mode. This opens up a prompt at the bottom of the screen, where you can enter a command or a search pattern.</p>

<p>In commandline mode, you can press <code>ctrl-p</code> to go backwards and <code>ctrl-n</code> to go forwards through your command history. The up and down arrow cursor keys also work.</p>

<table>
   <tr>
     <th>command</th>
     <th>action</th>
   </tr>
   <tr>
     <td><code>ctrl-p</code></td>
     <td>Show previous historical command/search</td>
   </tr>
   <tr>
     <td><code>ctrl-n</code></td>
     <td>Show next historical command/search</td>
   </tr>
   <tr>
     <td><code>ctrl-f</code></td>
     <td>Switch from commandline mode to the commandline window</td>
   </tr>
</table>

<p>If you need to make extensive edits to a command, change to the commandline window by pressing <code>ctrl-f</code>.</p>

<p>Note that <code>ctrl-f</code> is the default, but it can be customized using the <code>cedit</code> option. Read <a href="http://vimdoc.sourceforge.net/htmldoc/options.html#&amp;#x27;cedit&amp;#x27;"><code>:help cedit</code></a> for more information.</p>

<h2>The commandline window</h2>

<p>The commandline window shows your last 20 search patterns or commands. You can move up and down through them with the <code>k</code> and <code>j</code> keys, and when you press <code>&lt;enter&gt;</code> it executes the command underneath the cursor.</p>

<p>The cool thing about the command-line window is that it&rsquo;s a regular Vim buffer, so all of the editing commands that you are used to are available to you. This makes it extremely useful if you need to iterate on a search pattern.</p>

<table>
   <tr>
     <th>command</th>
     <th>action</th>
   </tr>
   <tr>
     <td><code>q/</code></td>
     <td>Open the commandline window with history of searches</td>
   </tr>
   <tr>
     <td><code>q:</code></td>
     <td>Open the commandline window with history of commands</td>
   </tr>
   <tr>
     <td><code>ctrl-f</code></td>
     <td>Switch from commandline mode to the commandline window</td>
   </tr>
</table>

<p>Note that you can customize the number of commands that Vim remembers with the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html#&amp;#x27;hi&amp;#x27;"><code>history</code></a> setting.</p>

<h2>Replacing prime marks with curly quotes</h2>

<p>In the video, I use the following example as a demonstration:</p>
<pre class="highlight plaintext">This string contains a 'quoted' word.
This string contains 'two' quoted 'words'.
This 'string doesn't make things easy'.
</pre>

<p>My intention is to replace the prime marks with curly double quotes, so that it looks like this:</p>
<pre class="highlight plaintext">This string contains a â€œquotedâ€ word.
This string contains â€œtwoâ€ quoted â€œwordsâ€.
This â€œstring doesn't make things easyâ€.
</pre>

<p>To create a suitable search pattern, I went through the following iterations:</p>
<pre class="highlight plaintext">\v'.+'
\v'[^']+'
\v'('\w|[^'])+'
\v'(('\w|[^'])+)'
</pre>

<p>The final pattern works for each of my test cases, so I can use it for a substitution command as follows:</p>
<pre class="highlight plaintext">/\v'(('\w|[^'])+)'
:%s//â€œ\1â€/gc
</pre>

<p>Here, I&rsquo;ve left the search field blank in the substitution command, which tells Vim to use the most recent search. Alternatively, I could hard code the search pattern into the substitution command:</p>
<pre class="highlight plaintext">:%s/\v'(('\w|[^'])+)'/â€œ\1â€/gc
</pre>

<p>When making this substitution on an entire document, I use the <code>c</code> flag so that I can inspect each substitution before either doing it or skipping it.</p>

<h3>Homework</h3>

<p>Note that this substitution command is not a complete solution for replacing prime marks with curly double quotes. It works for my 3 test cases, but there are other situations where it will fail. Here is one:</p>
<pre class="highlight plaintext">This string doesn't contain any quotes, isn't it.
</pre>

<p>Your homework, should you choose to accept it, is to refine the search pattern so that it handles this case appropriately. See if you can think up other failing test cases, and hone the substitution command to work for those as well. </p>

<h3>Further reading</h3>

<ul>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#q:">:help q:</a> - the command line window</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/options.html#&amp;#x27;cedit&amp;#x27;">:help cedit</a> - the key used in Command-line mode to open the command-line window</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#:s">:help :s[ubstitute]</a> - the substitute command</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#:s_flags">:help :s_flags</a> - the flags for the substitute command</li>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#/magic">:help /magic</a> - searching with <em>very magic</em> mode</li>
</ul>

        </div>
        </dd>
        <dd>
        <a href="#comments">Comments</a>
        <div id="comments" class="content">
          <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'vimcasts'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        </dd>
      </dl>

      <div>
        <p>
        Like this video? Spread the word!
        TODO: add social sharing buttons here.
        </p>
      </div>


      <div>
  <hr/>
  <h3>Related content</h3>
  <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3">

    
    

    
      <li>
        <h4><a href="/training">Vim Training</a></h4>
        <p>Boost your productivity with a <a href='/training'>Vim training class</a>. Join a public class, or <a href='/training/private'>book a private session</a> for your team.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/fugitive-vim---a-complement-to-command-line-git/">Fugitive.vim - a complement to command line git</a></h4>
        <p><a href="https://github.com/tpope/vim-fugitive">The fugitive plugin</a>, by Tim Pope, is a git wrapper for Vim. It  complements the command line interface to git, but doesn&rsquo;t aim to replace it. In this episode, we&rsquo;ll see how some of fugitive&rsquo;s commands can streamline your workflow.</p>

<p><em>This is the first of a five part series on fugitive.</em></p>


      </li>
    
      <li>
        <h4><a href="/publications">Publications</a></h4>
        <p>Make yourself a faster and more efficient developer with the help of <a href='/publications'>these publications</a>.</p>
      </li>
    
      <li>
        <h4><a href="/categories">Find by category</a></h4>
        <p>Vimcasts contains 65 free screencasts and 45 articles. <a href='/categories'>Browse all content by category</a>.</p>
      </li>
    
      <li>
        <h4><a href="/episodes/operating-on-search-matches-using-gn/">Operating on search matches using gn</a></h4>
        <p>The <code>gn</code> command (introduced in Vim 7.4) makes it easy to operate on regions of text that match the current search pattern. It&rsquo;s especially useful when used with a regex that matches text regions of variable length.</p>


      </li>
    
      <li>
        <h4><a href="/episodes/fugitive-vim-working-with-the-git-index/">Fugitive.vim - working with the git index</a></h4>
        <p>The fugitive plugin provides an interactive status window, where you can easily stage and review your changes for the next commit. The <code>:Gdiff</code> command visualizes the changes made to a file, by comparing the working copy with the index. In this episode, we&rsquo;ll learn how to stage hunks of changes to the index without using the <code>git add --patch</code> command.</p>

<p><em>This is the second of a five part series on fugitive.vim. In the next episode, we&rsquo;ll learn how to resolve a git merge conflict by performing a 3-way vimdiff.</em></p>


      </li>
    

  </ul>
</div>


      <div class="row footer">

  <hr/>

  <div class="small-6 columns">
    <ul class="inline-list">
      <li><a href="/about">About</a></li>
      <li><a href="/subscribe">Subscribe</a></li>
      <li><a href="/tipjar">Leave a tip</a></li>
    </ul>
  </div>

  <div class="small-6 columns">
    <p class="text-right">
    Vimcasts.org established MMX
    </p>
  </div>

</div>


    </div>
  </div>




      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script src="/javascripts/all.js" type="text/javascript"></script>

  </body>
</html>

