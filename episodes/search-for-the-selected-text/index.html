<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Search for the selected text</title>

    <link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>

  <body>
    <div id="logo">
      <h1>
        
          <a href="/" title="Go to Vimcasts.org homepage">VimCasts.org</a>
        
      </h1>
    </div>
    <p><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html#star">The <code>*</code> command</a> searches for the word under the cursor. That makes sense in Normal mode, but from Visual mode it would be more useful if the star command searched for the current <em>selection</em>, rather than the current word. We can add this feature to Vim using the <a href="https://github.com/nelstrom/vim-visual-star-search">visual star search plugin</a>.</p>

<p></p>

<p>Look up <a href="http://vimdoc.sourceforge.net/htmldoc/visual.html#visual-search"><code>:help visual-search</code></a> in Vim's documentation, and you'll find a suggestion for this simple mapping:</p>

<pre class="brush: vimscript">
:vmap X y/&lt;C-R&gt;&quot;&lt;CR&gt;
</pre>

<p>This comes with a warning: <strong>Note that special characters (like <code>.</code> and <code>*</code>) will cause problems.</strong> It's not too hard to avoid these problems. This snippet of code takes care of them:</p>

<pre class="brush: vimscript">
function! s:VSetSearch(cmdtype)
  let temp = @s
  norm! gv&quot;sy
  let @/ = '\V' . substitute(escape(@s, a:cmdtype.'\'), '\n', '\\n', 'g')
  let @s = temp
endfunction

xnoremap * :&lt;C-u&gt;call &lt;SID&gt;VSetSearch('/')&lt;CR&gt;/&lt;C-R&gt;=@/&lt;CR&gt;&lt;CR&gt;
xnoremap # :&lt;C-u&gt;call &lt;SID&gt;VSetSearch('?')&lt;CR&gt;?&lt;C-R&gt;=@/&lt;CR&gt;&lt;CR&gt;
</pre>

<p>You install the <a href="https://github.com/nelstrom/vim-visual-star-search">visual-star-search</a> plugin from github, which wraps up this functionality.</p>

<p>Note that these visual mode <code>*</code> and <code>#</code> mappings create a new record in Vim's search history. You can always paste the last search pattern by pressing <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R"><code>&lt;C-r&gt;/</code></a>, so you can easily search through multiple files using <code>:vimgrep</code>:</p>

<pre><code>:vimgrep /&lt;C-r&gt;//g **
</code></pre>

<p>Naturally, the patterns generated by these <code>*</code> and <code>#</code> mappings can also be used with any Ex command that accepts a pattern, including <code>:substitute</code>, <code>:global</code>, and <code>:vimgrep</code>.</p>

<h3 id="further-reading">Further reading</h3>

<ul>
  <li><a href="https://github.com/nelstrom/vim-visual-star-search">visual-star-search</a> plugin</li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/visual.html#visual-search"><code>:help visual-search</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#quote/"><code>:help quote/</code></a></li>
  <li><a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html#c_CTRL-R"><code>:help c_CTRL-R</code></a></li>
  <li><a href="http://pragprog.com/book/dnvim/practical-vim">Practical Vim</a> tip 86 - Search for the current visual selection</li>
  <li><a href="http://pragprog.com/book/dnvim/practical-vim">Practical Vim</a> tip 78 - Escape Problem Characters</li>
  <li><a href="http://got-ravings.blogspot.co.uk/2008/07/vim-pr0n-visual-search-mappings.html">Vim pr0n: Visual search mappings</a></li>
</ul>


  </body>

</html>
