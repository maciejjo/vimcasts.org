(function(){var t,e,n,i,r,s,o,a,c,l,h,u,d,v,p,f,y,m,g,k,x,b,w,N,T,I,O,L,M,A=Array.prototype.slice;e=function(){function t(e){var n,i,r,s;for(this.timelineOriginal=e.timelineOriginal.points.split(","),this.timelineRevised=e.timelineRevised.points.split(","),this.activeTrack=e.timelineRevised.active?"timelineRevised":"timelineOriginal",this.nodes=[],s=e.nodes||[{position:"s1"}],i=0,r=s.length;r>i;i++)n=s[i],e={state:n.state,position:n.position},this.nodes.push(e),"on"===n.state&&(this.activeNode=e);t.states.push(this)}return t.prototype.activeNodeIndex=function(){return this.nodes.indexOf(this.activeNode)},t.prototype.hasPredecessor=function(){return t.states.indexOf(this)>0},t.prototype.hasSuccessor=function(){return t.states.indexOf(this)<t.states.length-1},t.states=[],t.position=0,t.lastPosition=0,t.active=function(){return this.states[this.position]},t.previous=function(){return this.states[this.lastPosition]},t.reverse=function(){return this.position>0?(this.lastPosition=this.position,this.position--):void 0},t.advance=function(){return this.position<this.states.length-1?(this.lastPosition=this.position,this.position++):void 0},t.reset=function(){return this.lastPosition=this.position=0,this.states=[]},t}(),window.DocumentState=e,t=function(){function t(e){this.coordinates=e.coordinates,t.instances.push(this)}return t.prototype.myIndex=function(){return t.instances.indexOf(this)},t.prototype.next=function(){return t.instances[this.myIndex()+1]},t.prototype.prev=function(){return t.instances[this.myIndex()-1]},t.prototype.activate=function(){return t.activeChronologIndex=this.myIndex()},t.prototype.isActive=function(){return t.activeChronologIndex===this.myIndex()},t.instances=[],t.activeChronologIndex=0,t.active=function(){return this.instances[this.activeChronologIndex]},t.reverse=function(){return 0!==this.activeChronologIndex?this.activeChronologIndex--:void 0},t.advance=function(){return this.activeChronologIndex!==this.instances.length-1?this.activeChronologIndex++:void 0},t.reset=function(){return this.instances=[]},t}(),window.Chronolog=t,n=function(){function n(t){this.chronologs=t.chronologs,this.coordinates=t.coordinates.split(","),n.instances.push(this)}return n.prototype.activeChronologIndex=function(){return this.chronologs.indexOf(t.active())},n.prototype.activate=function(){var t;return t=n.instances.indexOf(this),n.currentTrackIndex=t},n.prototype.next=function(){return this.chronologs[this.activeChronologIndex()+1]},n.prototype.prev=function(){return this.chronologs[this.activeChronologIndex()-1]},n.instances=[],n.currentTrackIndex=0,n.currentTrack=function(){return this.instances[this.currentTrackIndex]},n.currentChronolog=function(){return t.active()},n.advanceAndUpdateState=function(t){return e.reset(),new e(n.asDocumentState()),this.advance(t),new e(n.asDocumentState())},n.reverseAndUpdateState=function(t){return e.reset(),new e(n.asDocumentState()),this.reverse(t),new e(n.asDocumentState())},n.advance=function(e){var i;if(i=n.currentTrack(),"track"===e){if(i=i.next(),null!=i)return i.activate()}else if("chronological"===e)return e=t.active(),i.chronologs.indexOf(e.next())<0&&n.switchTracks(),t.advance()},n.reverse=function(e){var i;if(i=n.currentTrack(),"track"===e){if(i=i.prev(),null!=i)return i.activate()}else if("chronological"===e)return e=t.active(),i.chronologs.indexOf(e.prev())<0&&n.switchTracks(),t.reverse()},n.atStart=function(){var e;return e=t.active(),t.instances[0]===e},n.atFinish=function(e){var i;return i=t.active(),"track"===e?(e=n.currentTrack(),e.chronologs[e.chronologs.length-1]===i):"chronological"===e?t.instances[t.instances.length-1]===i:void 0},n.switchTracks=function(){return this.currentTrackIndex=0===this.currentTrackIndex?1:0},n.asDocumentState=function(){var e,i,r,s,o;for(e={timelineOriginal:{points:this.instances[0].coordinates.join(",")},timelineRevised:{points:this.instances[1].coordinates.join(",")},nodes:[]},o=t.instances,r=0,s=o.length;s>r;r++)i=o[r],e.nodes.push({position:i.coordinates,state:i.isActive()?"on":"off"});return 0===n.currentTrackIndex?e.timelineOriginal.active=!0:e.timelineRevised.active=!0,e},n.reset=function(){return this.instances=[]},n}(),window.Timeline=n,g=new t({coordinates:"s1"}),L=new t({coordinates:"s2"}),b=new t({coordinates:"b3"}),p=new t({coordinates:"b4"}),r=new t({coordinates:"t5"}),x=new t({coordinates:"t6"}),new n({chronologs:[g,L,b,p],coordinates:"s1,s2,b3,b4"}),new n({chronologs:[g,L,r,x],coordinates:"s1,s2,t3,t5,t6"}).activate(),x.activate(),new e(n.asDocumentState()),p=Math.PI/6,r={black:"#444",darkgrey:"#888",white:"#fff"},k=null,s={},s.s1={x:90,y:150},s.s2={x:182,y:150},s.s3={x:274,y:150},s.s4={x:366,y:150},s.s5={x:458,y:150},s.s6={x:550,y:150},s.b3={x:s.s2.x+92*Math.cos(p),y:s.s2.y+92*Math.sin(p)},s.b4={x:s.b3.x+92,y:s.b3.y},s.t3={x:s.s2.x+92*Math.cos(p),y:s.s2.y-92*Math.sin(p)},s.t4={x:s.t3.x+92,y:s.t3.y},s.t5={x:s.t3.x+184,y:s.t3.y},s.t6={x:s.t3.x+276,y:s.t3.y},y={timelineOriginalThick:null,timelineOriginalThin:null,timelineRevisedThick:null,timelineRevisedThin:null,activeTimeline:null,activeNode:null,nodes:[],nodeNumbers:[],thickLineAttributes:{stroke:r.darkgrey,"stroke-width":8,"stroke-linecap":"butt","stroke-linejoin":"miter"},thinLineAttributes:{stroke:r.white,"stroke-width":7,"stroke-linecap":"butt","stroke-linejoin":"miter"},offNodeAttributes:{fill:r.white,stroke:r.black},onNodeAttributes:{fill:r.darkgrey,stroke:r.black}},i=["1955, November 12th\n    Lightning strikes the clocktower at 10.04pm","1955, November 5th\n    George McFly falls out of a tree and is hit by a car.\n\n1955, November 12th\n    Lightning strikes the clocktower at 10.04pm","1955, November 5th\n    George McFly falls out of a tree and is hit by a car.\n    Lorraine Baines nurses George, and thinks he's cute.\n\n1955, November 12th\n    Lightning strikes the clocktower at 10.04pm","1955, November 5th\n    George McFly falls out of a tree and is hit by a car.\n    Lorraine Baines nurses George, and thinks he's cute.\n\n1955, November 12th\n    George McFly takes Lorraine Baines to the dance, and they kiss.\n    Lighting strikes the clocktower at 10.04pm","1955, November 5th\n    Marty McFly is hit by a car.\n    Lorraine Baines nurses Marty, and thinks he's cute.\n\n1955, November 12th\n    Lighting strikes the clocktower at 10.04pm","1955, November 5th\n    Marty McFly is hit by a car.\n    Lorraine Baines nurses Marty, and thinks he's cute.\n\n1955, November 12th\n    Marty Mcfly takes Lorraine Baines to the dance, and they kiss (yuk).\n    Marty McFly invents Rock and Roll\n    George McFly and Loraine Baines kiss.\n    Lightning strikes the clocktower at 10.04pm"],f=function(){var t,e,n,i,r;for(e=arguments[0],t=2<=arguments.length?A.call(arguments,1):[],n=["M "+s[e].x+" "+s[e].y],i=0,r=t.length;r>i;i++)e=t[i],n.push("L "+s[e].x+" "+s[e].y);return n.join("")},v=function(t){return y.timelineOriginalThick=k.path(f.apply(null,t.timelineOriginal)).attr(y.thickLineAttributes),y.timelineOriginalThin=k.path(f.apply(null,t.timelineOriginal)).attr(y.thinLineAttributes),y.timelineRevisedThick=k.path(f.apply(null,t.timelineRevised)).attr(y.thickLineAttributes),y.timelineRevisedThin=k.path(f.apply(null,t.timelineRevised)).attr(y.thinLineAttributes)},l=function(t,e){return null==e&&(e=t.activeTrack),y.activeTimeline=k.path(f.apply(null,t[e])).attr(y.thickLineAttributes)},h=function(t){var e,n,i,r;for(y.nodes=[],y.nodeNumbers=[],r=[],i=0;5>=i;i+=1)n=t.nodes[i],r.push(null!=n.state?(e=k.circle(s[n.position].x,s[n.position].y,15).attr(y.offNodeAttributes),y.nodes.push(e),u(n,i)):void 0);return r},u=function(t,e){var n;return n=k.text(s[t.position].x,s[t.position].y+30,e+1),y.nodeNumbers.push(n)},a=function(t){return y.activeNode=k.circle(s[t.activeNode.position].x,s[t.activeNode.position].y,15).attr(y.onNodeAttributes)},d=function(){var t;return t=e.active(),v(t),l(t),h(t),a(t),M()},O=function(t,e){return v(e),y.timelineOriginalThick.animate({path:f.apply(null,t.timelineOriginal)},250,"<>"),y.timelineOriginalThin.animate({path:f.apply(null,t.timelineOriginal)},250,"<>"),y.timelineRevisedThick.animate({path:f.apply(null,t.timelineRevised)},250,"<>"),y.timelineRevisedThin.animate({path:f.apply(null,t.timelineRevised)},250,"<>")},N=function(t,e){var n;return n=t.activeTrack,l(e,n),y.activeTimeline.animate({path:f.apply(null,t[n])},250,"<>")},T=function(t,e){var n,i,r,o;for(h(e),o=[],r=0;5>=r&&(i=t.nodes[r],n=y.nodes[r],null!=n);r+=1)n.animate({cx:s[i.position].x,cy:s[i.position].y},250,"<>"),n=y.nodeNumbers[r],o.push(n.animate({x:s[i.position].x,y:s[i.position].y+30},250,"<>"));return o},w=function(t,e){return a(e),y.activeNode.animate({cx:s[t.activeNode.position].x,cy:s[t.activeNode.position].y},250,"<>",c)},c=function(){var t;return t=e.active(),u(t.activeNode,t.activeNodeIndex())},I=function(){var t,n;return k.clear(),t=e.active(),n=e.previous(),O(t,n),N(t,n),T(t,n),w(t,n),M()},M=function(){var t;return t=e.active(),$("#vim-history-buffer code pre").html(i[t.activeNodeIndex()])},m=function(){if(!$(this).hasClass("disabled")){switch($(this).attr("class")){case"undo":n.reverseAndUpdateState("track");break;case"redo":n.advanceAndUpdateState("track");break;case"earlier":n.reverseAndUpdateState("chronological");break;case"later":n.advanceAndUpdateState("chronological")}e.advance(),I(),o()}return!1},o=function(){return $("#vim-history-buttons a").each(function(){var t;return $(this).removeClass("disabled"),t=$(this).attr("class"),n.atStart("track")&&"undo"===t&&$(this).addClass("disabled"),n.atStart("chronological")&&"earlier"===t&&$(this).addClass("disabled"),n.atFinish("track")&&"redo"===t&&$(this).addClass("disabled"),n.atFinish("chronological")&&"later"===t?$(this).addClass("disabled"):void 0})},jQuery($(function(t,e){return function(){return t.apply(e,arguments)}}(function(){return $("#vim-history-visualization").append('<div id="vim-history-buffer">\n  <code><pre></pre></code>\n</div>\n<div id="vim-history-buttons">\n  <a class="undo" href="#">undo</a>\n  <a class="redo" href="#">redo</a>\n  <a class="later" href="#">later</a>\n  <a class="earlier" href="#">earlier</a>\n</div>\n<div id="vim-history-graph"/>'),$("#vim-history-buttons a").click(m),o(),k=Raphael("vim-history-graph",640,300),d()},this))),window.graphics=y}).call(this);